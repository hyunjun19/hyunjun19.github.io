{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/webkit-error.png","path":"images/webkit-error.png","modified":0,"renderable":0},{"_id":"themes/alpha-dust/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/alpha-dust/source/img/bg-pattern.png","path":"img/bg-pattern.png","modified":0,"renderable":1},{"_id":"themes/alpha-dust/source/js/main.js","path":"js/main.js","modified":0,"renderable":1}],"Cache":[{"_id":"themes/alpha-dust/.gitignore","hash":"2aa039aab52800662710bbf503671c770af96621","modified":1519030486269},{"_id":"themes/alpha-dust/LICENSE","hash":"20fb6ab02264ce4860e25cd70b50fa86c08f1cf8","modified":1519030486269},{"_id":"themes/alpha-dust/README.md","hash":"63bcabd1bec8fd2125e2d0829f77352671c3229e","modified":1519030486269},{"_id":"themes/alpha-dust/_config.yml","hash":"6831b925754b42f30846f68fd93b999ffd6a9782","modified":1519033231590},{"_id":"source/_posts/how-cookie-works.md","hash":"e308e127c2042531ca0bacf5a37925f7db689302","modified":1519029612732},{"_id":"source/_posts/server-network-perf.md","hash":"507fb9b4b0c952142f8a63bc8a92619680199d9c","modified":1519029612741},{"_id":"source/_posts/ts-ios-wifi-webkit-error.md","hash":"6b898778a00e17a77dba404b33fe61a9d928e5aa","modified":1519029612744},{"_id":"source/_posts/ts-spring-session-oome.md","hash":"0ae128ba4b9bca2f28d0084fbee43772860e74a5","modified":1519029612744},{"_id":"source/categories/index.md","hash":"1d82829deb2de62243e482e0464cc7a4a71009ad","modified":1519033222685},{"_id":"source/images/webkit-error.png","hash":"2f96a352cae97eb708e47ee75c367f8728ad69a5","modified":1519029612744},{"_id":"source/tags/index.md","hash":"e61ab2c947a391745890c6e1340ef7c940074fbe","modified":1519033161982},{"_id":"themes/alpha-dust/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1519030486264},{"_id":"themes/alpha-dust/.git/config","hash":"d4dd417701b9cddba99958c69486c3d0f1faa162","modified":1519030486265},{"_id":"themes/alpha-dust/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1519030484510},{"_id":"themes/alpha-dust/.git/index","hash":"dc4994bfc2280d865d6854a76a9e4424936588ce","modified":1519030486285},{"_id":"themes/alpha-dust/.git/packed-refs","hash":"1134a4cd3ee7c6043d75c60ee6641cfb369b18f3","modified":1519030486262},{"_id":"themes/alpha-dust/languages/de.yml","hash":"424a9c1e6ab69334d7873f6574da02ca960aa572","modified":1519030486270},{"_id":"themes/alpha-dust/languages/default.yml","hash":"bc4b0f68c3579f8d9c217b96ae9d2da1991c92f7","modified":1519030486270},{"_id":"themes/alpha-dust/languages/en.yml","hash":"9debce519356b44354cf1a613f8916321e572d7f","modified":1519030486270},{"_id":"themes/alpha-dust/languages/es.yml","hash":"cb4eeca0ed3768a77e0cd216300f2b2549628b1b","modified":1519030486270},{"_id":"themes/alpha-dust/languages/fr.yml","hash":"e9e6f7cb362ebb7997f11027498a2748fe3bac95","modified":1519030486270},{"_id":"themes/alpha-dust/languages/no.yml","hash":"8ca475a3b4f8efe6603030f0013aae39668230e1","modified":1519030486270},{"_id":"themes/alpha-dust/languages/pl.yml","hash":"de7eb5850ae65ba7638e907c805fea90617a988c","modified":1519030486270},{"_id":"themes/alpha-dust/languages/ru.yml","hash":"42df7afeb7a35dc46d272b7f4fb880a9d9ebcaa5","modified":1519030486271},{"_id":"themes/alpha-dust/languages/pt.yml","hash":"1d0c3689eb32fe13f37f8f6f303af7624ebfbaf0","modified":1519030486270},{"_id":"themes/alpha-dust/languages/zh-TW.yml","hash":"9acac6cc4f8002c3fa53ff69fb8cf66c915bd016","modified":1519030486271},{"_id":"themes/alpha-dust/languages/zh-CN.yml","hash":"7bfcb0b8e97d7e5edcfca8ab26d55d9da2573c1c","modified":1519030486271},{"_id":"themes/alpha-dust/layout/archive.ejs","hash":"535ea1205c3dd8782aa8dec64c5bb67a5e118be9","modified":1519030486273},{"_id":"themes/alpha-dust/layout/index.ejs","hash":"a3f94e4a627a83735b82d93694980e988a32d65e","modified":1519030486273},{"_id":"themes/alpha-dust/layout/layout.ejs","hash":"2655449a77b370284e6af41aa72c7d72660008fa","modified":1519030486273},{"_id":"themes/alpha-dust/layout/page.ejs","hash":"8b54e1af70b375b92837885814d26c0629253bc1","modified":1519030486273},{"_id":"themes/alpha-dust/layout/post.ejs","hash":"5e1c76ceea8fb6f770b0592648d7e31ccea21a82","modified":1519030486273},{"_id":"themes/alpha-dust/template/archive.html","hash":"239ef36831f10f892ecdbf4438994d62cc973caa","modified":1519030486276},{"_id":"themes/alpha-dust/template/index.html","hash":"8f5f763e912a2f84306e3857b476c5cd1c048cb0","modified":1519030486284},{"_id":"themes/alpha-dust/template/post.html","hash":"8c586749ca621e6b24c07d792cb28c7827a0ed21","modified":1519030486284},{"_id":"source/_posts/ts-ios-wifi-webkit-error/webkit-error.png","hash":"c66697ade7667f53aaaeb0b3179c27840b8999c5","modified":1519029612744},{"_id":"themes/alpha-dust/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1519030484510},{"_id":"themes/alpha-dust/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1519030484512},{"_id":"themes/alpha-dust/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1519030484512},{"_id":"themes/alpha-dust/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1519030484511},{"_id":"themes/alpha-dust/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1519030484512},{"_id":"themes/alpha-dust/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1519030484510},{"_id":"themes/alpha-dust/.git/logs/HEAD","hash":"56d3b2ee7e577d9109a5eea44ef674e4806b85da","modified":1519030486265},{"_id":"themes/alpha-dust/layout/_partial/after-footer.ejs","hash":"15d1d1376aabe398cce7d18ff4af41635970dd29","modified":1519030486271},{"_id":"themes/alpha-dust/layout/_partial/article-archive.ejs","hash":"460768ed91c4bf71199f01685d7af385354ffd28","modified":1519030486271},{"_id":"themes/alpha-dust/layout/_partial/article-long.ejs","hash":"f2b2d0165cb35e30c9764c324e530f487e7de59e","modified":1519030486271},{"_id":"themes/alpha-dust/layout/_partial/article-short.ejs","hash":"792602a61177c8059ef27efd695532f456c8ca84","modified":1519030486271},{"_id":"themes/alpha-dust/layout/_partial/comments.ejs","hash":"423529d88d45e0a928f6cfadcf9aef27ccb63c13","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/footer.ejs","hash":"1723a9bebcafc39007f58f2fbce597a2836f8276","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/footer_categories.ejs","hash":"1831ae75b1deb1729e858b2cd83e32fff3a33f6f","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/footer_recent_posts.ejs","hash":"569addbbc7d548fca4986e09631489f8515280ff","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/gallery.ejs","hash":"80c3758b90fe6c197b52602456e2c4dcf7167847","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/google-analytics.ejs","hash":"4e6e8de9becea5a1636a4dcadcf7a10c06e2426e","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/head.ejs","hash":"668eca04a5e2ff2dbd2d99135b2a5428686e73d8","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/header.ejs","hash":"c189a234d36c6b5c51f814007d5d779bf42f0191","modified":1519030486272},{"_id":"themes/alpha-dust/layout/_partial/menu.ejs","hash":"452e31aa3016cdf9febfe5c2597a335417873f08","modified":1519030486273},{"_id":"themes/alpha-dust/layout/_partial/pagination.ejs","hash":"b9ec572a16d79cba2341211d7623cd04d2b6e521","modified":1519030486273},{"_id":"themes/alpha-dust/layout/_partial/tag-cat-item.ejs","hash":"62e78d4f9cccaa1f32121309498596d6b4c5f0ad","modified":1519030486273},{"_id":"themes/alpha-dust/source/css/style.styl","hash":"47e8e5969922a74d0df6f3e8686b538a22db04ae","modified":1519030486275},{"_id":"themes/alpha-dust/source/img/bg-pattern.png","hash":"932374ff0b431bf83d092948e1714d90254dd92e","modified":1519030486275},{"_id":"themes/alpha-dust/source/js/main.js","hash":"7ee829ab42cf4d81280d20b5d664759436b19075","modified":1519030486275},{"_id":"themes/alpha-dust/template/css/font-awesome.css","hash":"4eda182cbcc046dbf449aef97c02c230cf80a494","modified":1519030486276},{"_id":"themes/alpha-dust/template/css/style.css","hash":"50bf62012aa42d76e71ef6c6d359e0c6b02f1f41","modified":1519030486276},{"_id":"themes/alpha-dust/template/css/font-awesome.min.css","hash":"fb5b49426dee7f1508500e698d1b3c6b04c8fcce","modified":1519030486276},{"_id":"themes/alpha-dust/template/css/style.styl","hash":"792ff84e3a2b75cbdc216c8b37089eff0c4ec6bc","modified":1519030486276},{"_id":"themes/alpha-dust/template/img/bg-pattern copy.png","hash":"932374ff0b431bf83d092948e1714d90254dd92e","modified":1519030486282},{"_id":"themes/alpha-dust/template/img/bg-pattern-blue.png","hash":"07016986a35c5bfc04c1599829d6a4798c966731","modified":1519030486283},{"_id":"themes/alpha-dust/template/img/bg-pattern.png","hash":"932374ff0b431bf83d092948e1714d90254dd92e","modified":1519030486283},{"_id":"themes/alpha-dust/template/img/hex-bg.png","hash":"a8444a553dd0fd7db09eda830bd3346cc87fc60e","modified":1519030486283},{"_id":"themes/alpha-dust/template/js/main.js","hash":"656d203e231f4533d97654816ff285fcbdfd0956","modified":1519030486284},{"_id":"source/_posts/how-cookie-works/breadcrumbs.jpg","hash":"e719fdae6f7b1f90246819b20750be661a3ae84b","modified":1519029612732},{"_id":"source/_posts/how-cookie-works/http-req-res.png","hash":"9ab4094f32da7113f22b91652972bc97fc165e39","modified":1519029612741},{"_id":"themes/alpha-dust/template/fonts/FontAwesome.otf","hash":"1b22f17fdc38070de50e6d1ab3a32da71aa2d819","modified":1519030486277},{"_id":"themes/alpha-dust/template/fonts/fontawesome-webfont.eot","hash":"965ce8f688fedbeed504efd498bc9c1622d12362","modified":1519030486278},{"_id":"themes/alpha-dust/template/fonts/fontawesome-webfont.woff","hash":"6d7e6a5fc802b13694d8820fc0138037c0977d2e","modified":1519030486282},{"_id":"themes/alpha-dust/template/fonts/fontawesome-webfont.woff2","hash":"97e438cc545714309882fbceadbf344fcaddcec5","modified":1519030486282},{"_id":"themes/alpha-dust/template/img/session_image.jpeg","hash":"5a3669c0564044f56cb7cea464119a8e388fb18f","modified":1519030486284},{"_id":"themes/alpha-dust/.git/objects/pack/pack-bbaabf69821950b7aa3ef62e0420369ecd7446a8.idx","hash":"80fd4647874009aebdfc082fac2e51e4fdb9c45f","modified":1519030486255},{"_id":"themes/alpha-dust/.git/refs/heads/master","hash":"92fe38004c647392b4366303db2b6b64f162a032","modified":1519030486264},{"_id":"themes/alpha-dust/source/css/_partial/archive.styl","hash":"77f7b4341cb8d12191035150de6bb04635eb2a89","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/base.styl","hash":"f01047771a92520cf318930331517f4c9e70c04a","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/code.styl","hash":"3d2bbfef131c2f3fc5d44f54597da850ce29e2cf","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/footer.styl","hash":"0a086dfb77bc55b27378f97e442e3a696f69048f","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/header.styl","hash":"2e1e2ab562719127c7e216a49f8d7c02f9a0c2c4","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/menu.styl","hash":"746c0bc7b37096b5f0f0a451c4783a054b22c309","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/pagination.styl","hash":"2368cc9bd2404bce950b55fb2d9be3e7f1e1039c","modified":1519030486274},{"_id":"themes/alpha-dust/source/css/_partial/post-content.styl","hash":"117b655a4f0c78b3cb3fb7be3e09b829c1debc49","modified":1519030486275},{"_id":"themes/alpha-dust/source/css/_partial/variables.styl","hash":"789108805cf6d536b8a979a722b5b26a7e27fb28","modified":1519030486275},{"_id":"themes/alpha-dust/source/css/_partial/post-layout.styl","hash":"b60fbbd78ca88d2174db1426cf941b6c998dd823","modified":1519030486275},{"_id":"themes/alpha-dust/template/fonts/fontawesome-webfont.ttf","hash":"61d8d967807ef12598d81582fa95b9f600c3ee01","modified":1519030486281},{"_id":"themes/alpha-dust/.git/logs/refs/heads/master","hash":"56d3b2ee7e577d9109a5eea44ef674e4806b85da","modified":1519030486265},{"_id":"themes/alpha-dust/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1519030486264},{"_id":"themes/alpha-dust/template/fonts/fontawesome-webfont.svg","hash":"c0522272bbaef2acb3d341912754d6ea2d0ecfc0","modified":1519030486280},{"_id":"themes/alpha-dust/.git/logs/refs/remotes/origin/HEAD","hash":"56d3b2ee7e577d9109a5eea44ef674e4806b85da","modified":1519030486264},{"_id":"source/_posts/server-network-perf/highway-393492_1920.jpg","hash":"3b51268260b4815eeba39daac39bb23f74a918f9","modified":1519029612743},{"_id":"themes/alpha-dust/.git/objects/pack/pack-bbaabf69821950b7aa3ef62e0420369ecd7446a8.pack","hash":"2ad0d636fcdd44559cc048266e6d0ebd95107616","modified":1519030486255},{"_id":"source/_posts/how-cookie-works/dev-tools-cookie.png","hash":"f04e8b9f5dc0f99c0075061a70e62a1764adaf14","modified":1519029612740},{"_id":"public/categories/index.html","hash":"145fecfa5dddf5fe226d5fa1da309395ca4d68d8","modified":1519033565771},{"_id":"public/tags/index.html","hash":"7127c7e1e487529f163a09f44936169d7a3a94fc","modified":1519033565774},{"_id":"public/2017/09/23/how-cookie-works/index.html","hash":"7700c696dcd3602ebdd3561cf9991e09331de0d9","modified":1519033565775},{"_id":"public/2017/09/21/server-network-perf/index.html","hash":"9c2affb5b9a3b4125a5ca352956b4110f5caf6c7","modified":1519033565775},{"_id":"public/2017/08/24/ts-ios-wifi-webkit-error/index.html","hash":"9189643339a3fe77c409b326a7b3b6712cf09fc7","modified":1519033565775},{"_id":"public/archives/index.html","hash":"d9c5586bb05bf2f8ca03e4d5887a424525269c86","modified":1519033565775},{"_id":"public/archives/2017/index.html","hash":"ad3b372fdf2d93fbc72ba3eccfc239323a8fc8b4","modified":1519033565777},{"_id":"public/archives/2017/08/index.html","hash":"0d9acff611d628b78db6de42412f188e90b090b0","modified":1519033565777},{"_id":"public/archives/2017/09/index.html","hash":"c7d844dbb0f0ad9391aa3d2b418c7a4a24a593d4","modified":1519033565777},{"_id":"public/2017/08/24/ts-spring-session-oome/index.html","hash":"d3cbfc464fadd64ba7a59e4c7a5863bc71269624","modified":1519033565777},{"_id":"public/index.html","hash":"cd4bd8c9fee24fea8a7ce5e94ecdbbeb0a51492d","modified":1519033565779},{"_id":"public/images/webkit-error.png","hash":"2f96a352cae97eb708e47ee75c367f8728ad69a5","modified":1519033565779},{"_id":"public/img/bg-pattern.png","hash":"932374ff0b431bf83d092948e1714d90254dd92e","modified":1519033565779},{"_id":"public/2017/08/24/ts-ios-wifi-webkit-error/webkit-error.png","hash":"c66697ade7667f53aaaeb0b3179c27840b8999c5","modified":1519033565779},{"_id":"public/2017/09/23/how-cookie-works/breadcrumbs.jpg","hash":"e719fdae6f7b1f90246819b20750be661a3ae84b","modified":1519033565973},{"_id":"public/2017/09/23/how-cookie-works/http-req-res.png","hash":"9ab4094f32da7113f22b91652972bc97fc165e39","modified":1519033565974},{"_id":"public/css/style.css","hash":"a8b4312a0a6e600e3c1629df20e2860757370d10","modified":1519033565976},{"_id":"public/js/main.js","hash":"7ee829ab42cf4d81280d20b5d664759436b19075","modified":1519033565976},{"_id":"public/2017/09/21/server-network-perf/highway-393492_1920.jpg","hash":"3b51268260b4815eeba39daac39bb23f74a918f9","modified":1519033565983},{"_id":"public/2017/09/23/how-cookie-works/dev-tools-cookie.png","hash":"f04e8b9f5dc0f99c0075061a70e62a1764adaf14","modified":1519033565992}],"Category":[],"Data":[],"Page":[{"title":"All categories","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: All categories\ntype: \"categories\"\n---\n","date":"2018-02-19T09:40:22.685Z","updated":"2018-02-19T09:40:22.685Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjdu1d4ir0001570701m5pv9j","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"All tags","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: All tags\ntype: \"tags\"\n---\n","date":"2018-02-19T09:39:21.982Z","updated":"2018-02-19T09:39:21.982Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjdu1d4iw00035707fecgox4x","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"how-cookie-works","date":"2017-09-23T00:25:33.000Z","_content":"\n# How Cookie Works\n\n## Cookie란?\nHTTP는 기본적으로 [무상태 프로토콜](https://ko.wikipedia.org/wiki/무상태_프로토콜)입니다. \nHTTP 서버가 클라이언트에 대한 상태를 가지고 있지 않기 때문에 각각의 요청을 이전 요청과 무관한 독립적인 트랜잭션으로 취급하게 됩니다.\n하지만 그렇게 되면 세션과 개인화(회원별 서비스)등을 관리할 수 없게 되기 때문에 Cookie(이하 쿠키)를 사용하게 됩니다.\n\nHTTP의 쿠키는 마치 헨젤과 그레텔의 쿠키(~~돌맹이나 빵 버전도 있습니다.~~)와 같습니다.\n헨젤과 그레텔은 자신들이 돌아갈 길을 잊지 않기 위해서 사용하지만 HTTP의 쿠키는 HTTP 요청을 보내는 클라이언트를 식별하기 위해서 사용합니다.\n{% asset_img 'breadcrumbs.jpg' '헨젤과 그레텔의 쿠키' %}\n\n## HTTP 메시지\n__***[주의] 아래 설명은 웹 브라우저를 기반으로 설명한 내용입니다. 서버나 앱, 크롤러 등 다른 클라이언트에서 HTTP를 호출하는 경우 설정에 따라 다르게 동작합니다.***__\n{% asset_img 'http-req-res.png' '쿠키 생성 과정' %}\n1. 최초 HTTP 요청\n  * 웹브라우저에서 처음 방문하는 웹사이트에 요청을 보냅니다.\n1. 세션 ID 발급\n  * ``Set-Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; Expires=Fri, 20-Oct-2017 15:24:31 GMT; Path=/``\n  * ``Set-Cookie:SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1; Path=/; Secure; HttpOnly``\n  * ``Set-Cookie`` 필드에 대한 상세 정보는 [MDN 문서](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie)를 참고해주세요.\n  * __***[주의] 모든 사이트가 항상 최초의 요청에 세션 ID를 발급하는 것은 아닙니다. 하지만 일반적으로 거의 모든 사이트가 사용자 추적을 위해서 최초 방문시 세션 ID를 발급하며 세션 ID 명이나 값 등의 상세 정책은 사이트마다 다를 수 있습니다.***__\n1. 모든 요청 헤더에 Cookie 포함\n  * ``Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1``\n  * 이때 동일한 도메인으로 보내는 모든 요청에 쿠키가 포함되어 요청이 날아갑니다. HTML, CSS, JS, 이미지 등 모든 요청 헤더에 쿠키가 달라붙습니다. 아래 [상세 내용](#주의하세요)을 참고해 주세요.\n1. 응답 헤더에는 Cookie 미포함\n\n## 주의하세요~\n예전에는 쿠키를 브라우저의 클라이언트 데이터 저장용으로 사용하는 경우도 있었지만 ``localStorage``, ``sessionStorage``(IE8 이상 지원)가 있는 이상 더 이상 쿠키를 데이터 베이스처럼 사용해서는 안됩니다.\n쿠키는 크기 제한(브라우저 마다 다릅니다.)이 있으며 HTTP 요청을 주고 받을 때 마다 헤더를 통해서 전송이 되므로 성능상 낭비가 일어나게 됩니다.\nIE8 이전의 시대에는 대안이 없었지만 현재는 IE8 미만의 브라우저는 거의 없으므로 클라이언트 데이터 저장은 용도에 맞게 ``localStorage``, ``sessionStorage``에 저장해야 합니다.\n\n쿠키의 크기가 1KB, 화면 하나에 HTTP 요청이 10개, 서버에 사용자가 동시에 100명이 동시에 접속한다고 가정하면 서버에 1MB의 불필요한 트래픽이 발생하게 됩니다.\n동시접속 사용자가 적을 경우는 괜찮지만 서비스가 성장하게 되면 반드시 성능상 문제가 발생하게 됩니다.\n\n## 쿠키 상세 정보\n{% asset_img 'dev-tools-cookie.png' '크롬 개발자 도구 Application 탭' %}\n1. Name\n  * 쿠키 이름(키))\n1. Value\n  * 쿠키 값\n1. Domain\n  * 쿠키가 적용될 도메인 정보\n  * 브라우저는 도메인 정보가 같은 쿠키만 요청 헤더에 ``Cookie`` 필드를 자동으로 추가 합니다.\n1. Path\n  * 쿠키를 경로를 지정해서 마치 폴더와 같이 관리할 수 있습니다.\n1. Expires\n  * ``Expires``에 명시된 날짜에 쿠키가 만료(삭제)됩니다.\n  * ``Expires``, ``Max-Age``가 명시되지 않은 경우 세션 쿠키입니다. 브라우저가 종료되면 해당 쿠키는 삭제됩니다. 하지만 요즘 브라우저들은 종료되었다가 다시 시작되어도 [이전 세션을 복원하는 기능]((https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou)이 있어서 세션이 계속 유지되는 경우가 많습니다.\n1. HttpOnly\n  * ``HttpOnly`` 필드가 선언되면 스크립트에서는 해당 쿠키에 접근할 수 없습니다. 하지만 브라우저가 아닌 다른 클라이언트(ex. 크롤러)에서 접근하면 해당 정보를 취득할 수 있습니다.\n1. Secure\n  * ``Secure`` 필드가 선언되면 해당 쿠키는 HTTPS(SSL) 프로토콜을 사용한 경우에만 전송이 됩니다. 하지만 그렇다고 하더라도 절대로 민감한 정보를 담아서는 안됩니다.\n좀 더 상세한 내용은 MDN에서 한글로 번역된 [상세한 문서](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)를 참고해 주세요.\n\n## 쿠키를 이용한 세션관리\n웹에서는 쿠키를 이용해서 세션을 관리하게 됩니다.\n쿠키를 이용한 세션관리는 다음 편에서 별도로 설명하겠습니다.\n\n## 관련자료\n[MDN HTTP 쿠키](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)\n[MDN Set-Cookie](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie)\n[RFC-6265](https://tools.ietf.org/html/rfc6265#section-4.1)\n[브라우저 세션 복원](https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou)\n","source":"_posts/how-cookie-works.md","raw":"---\ntitle: how-cookie-works\ndate: 2017-09-23 09:25:33\ntags:\n---\n\n# How Cookie Works\n\n## Cookie란?\nHTTP는 기본적으로 [무상태 프로토콜](https://ko.wikipedia.org/wiki/무상태_프로토콜)입니다. \nHTTP 서버가 클라이언트에 대한 상태를 가지고 있지 않기 때문에 각각의 요청을 이전 요청과 무관한 독립적인 트랜잭션으로 취급하게 됩니다.\n하지만 그렇게 되면 세션과 개인화(회원별 서비스)등을 관리할 수 없게 되기 때문에 Cookie(이하 쿠키)를 사용하게 됩니다.\n\nHTTP의 쿠키는 마치 헨젤과 그레텔의 쿠키(~~돌맹이나 빵 버전도 있습니다.~~)와 같습니다.\n헨젤과 그레텔은 자신들이 돌아갈 길을 잊지 않기 위해서 사용하지만 HTTP의 쿠키는 HTTP 요청을 보내는 클라이언트를 식별하기 위해서 사용합니다.\n{% asset_img 'breadcrumbs.jpg' '헨젤과 그레텔의 쿠키' %}\n\n## HTTP 메시지\n__***[주의] 아래 설명은 웹 브라우저를 기반으로 설명한 내용입니다. 서버나 앱, 크롤러 등 다른 클라이언트에서 HTTP를 호출하는 경우 설정에 따라 다르게 동작합니다.***__\n{% asset_img 'http-req-res.png' '쿠키 생성 과정' %}\n1. 최초 HTTP 요청\n  * 웹브라우저에서 처음 방문하는 웹사이트에 요청을 보냅니다.\n1. 세션 ID 발급\n  * ``Set-Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; Expires=Fri, 20-Oct-2017 15:24:31 GMT; Path=/``\n  * ``Set-Cookie:SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1; Path=/; Secure; HttpOnly``\n  * ``Set-Cookie`` 필드에 대한 상세 정보는 [MDN 문서](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie)를 참고해주세요.\n  * __***[주의] 모든 사이트가 항상 최초의 요청에 세션 ID를 발급하는 것은 아닙니다. 하지만 일반적으로 거의 모든 사이트가 사용자 추적을 위해서 최초 방문시 세션 ID를 발급하며 세션 ID 명이나 값 등의 상세 정책은 사이트마다 다를 수 있습니다.***__\n1. 모든 요청 헤더에 Cookie 포함\n  * ``Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1``\n  * 이때 동일한 도메인으로 보내는 모든 요청에 쿠키가 포함되어 요청이 날아갑니다. HTML, CSS, JS, 이미지 등 모든 요청 헤더에 쿠키가 달라붙습니다. 아래 [상세 내용](#주의하세요)을 참고해 주세요.\n1. 응답 헤더에는 Cookie 미포함\n\n## 주의하세요~\n예전에는 쿠키를 브라우저의 클라이언트 데이터 저장용으로 사용하는 경우도 있었지만 ``localStorage``, ``sessionStorage``(IE8 이상 지원)가 있는 이상 더 이상 쿠키를 데이터 베이스처럼 사용해서는 안됩니다.\n쿠키는 크기 제한(브라우저 마다 다릅니다.)이 있으며 HTTP 요청을 주고 받을 때 마다 헤더를 통해서 전송이 되므로 성능상 낭비가 일어나게 됩니다.\nIE8 이전의 시대에는 대안이 없었지만 현재는 IE8 미만의 브라우저는 거의 없으므로 클라이언트 데이터 저장은 용도에 맞게 ``localStorage``, ``sessionStorage``에 저장해야 합니다.\n\n쿠키의 크기가 1KB, 화면 하나에 HTTP 요청이 10개, 서버에 사용자가 동시에 100명이 동시에 접속한다고 가정하면 서버에 1MB의 불필요한 트래픽이 발생하게 됩니다.\n동시접속 사용자가 적을 경우는 괜찮지만 서비스가 성장하게 되면 반드시 성능상 문제가 발생하게 됩니다.\n\n## 쿠키 상세 정보\n{% asset_img 'dev-tools-cookie.png' '크롬 개발자 도구 Application 탭' %}\n1. Name\n  * 쿠키 이름(키))\n1. Value\n  * 쿠키 값\n1. Domain\n  * 쿠키가 적용될 도메인 정보\n  * 브라우저는 도메인 정보가 같은 쿠키만 요청 헤더에 ``Cookie`` 필드를 자동으로 추가 합니다.\n1. Path\n  * 쿠키를 경로를 지정해서 마치 폴더와 같이 관리할 수 있습니다.\n1. Expires\n  * ``Expires``에 명시된 날짜에 쿠키가 만료(삭제)됩니다.\n  * ``Expires``, ``Max-Age``가 명시되지 않은 경우 세션 쿠키입니다. 브라우저가 종료되면 해당 쿠키는 삭제됩니다. 하지만 요즘 브라우저들은 종료되었다가 다시 시작되어도 [이전 세션을 복원하는 기능]((https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou)이 있어서 세션이 계속 유지되는 경우가 많습니다.\n1. HttpOnly\n  * ``HttpOnly`` 필드가 선언되면 스크립트에서는 해당 쿠키에 접근할 수 없습니다. 하지만 브라우저가 아닌 다른 클라이언트(ex. 크롤러)에서 접근하면 해당 정보를 취득할 수 있습니다.\n1. Secure\n  * ``Secure`` 필드가 선언되면 해당 쿠키는 HTTPS(SSL) 프로토콜을 사용한 경우에만 전송이 됩니다. 하지만 그렇다고 하더라도 절대로 민감한 정보를 담아서는 안됩니다.\n좀 더 상세한 내용은 MDN에서 한글로 번역된 [상세한 문서](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)를 참고해 주세요.\n\n## 쿠키를 이용한 세션관리\n웹에서는 쿠키를 이용해서 세션을 관리하게 됩니다.\n쿠키를 이용한 세션관리는 다음 편에서 별도로 설명하겠습니다.\n\n## 관련자료\n[MDN HTTP 쿠키](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)\n[MDN Set-Cookie](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie)\n[RFC-6265](https://tools.ietf.org/html/rfc6265#section-4.1)\n[브라우저 세션 복원](https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou)\n","slug":"how-cookie-works","published":1,"updated":"2018-02-19T08:40:12.732Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjdu1d4im00005707u4zrrvbs","content":"<h1 id=\"How-Cookie-Works\"><a href=\"#How-Cookie-Works\" class=\"headerlink\" title=\"How Cookie Works\"></a>How Cookie Works</h1><h2 id=\"Cookie란\"><a href=\"#Cookie란\" class=\"headerlink\" title=\"Cookie란?\"></a>Cookie란?</h2><p>HTTP는 기본적으로 <a href=\"https://ko.wikipedia.org/wiki/무상태_프로토콜\" target=\"_blank\" rel=\"noopener\">무상태 프로토콜</a>입니다.<br>HTTP 서버가 클라이언트에 대한 상태를 가지고 있지 않기 때문에 각각의 요청을 이전 요청과 무관한 독립적인 트랜잭션으로 취급하게 됩니다.<br>하지만 그렇게 되면 세션과 개인화(회원별 서비스)등을 관리할 수 없게 되기 때문에 Cookie(이하 쿠키)를 사용하게 됩니다.</p>\n<p>HTTP의 쿠키는 마치 헨젤과 그레텔의 쿠키(<del>돌맹이나 빵 버전도 있습니다.</del>)와 같습니다.<br>헨젤과 그레텔은 자신들이 돌아갈 길을 잊지 않기 위해서 사용하지만 HTTP의 쿠키는 HTTP 요청을 보내는 클라이언트를 식별하기 위해서 사용합니다.<br><img src=\"/2017/09/23/how-cookie-works/breadcrumbs.jpg\" title=\"헨젤과 그레텔의 쿠키\"></p>\n<h2 id=\"HTTP-메시지\"><a href=\"#HTTP-메시지\" class=\"headerlink\" title=\"HTTP 메시지\"></a>HTTP 메시지</h2><p><strong><strong><em>[주의] 아래 설명은 웹 브라우저를 기반으로 설명한 내용입니다. 서버나 앱, 크롤러 등 다른 클라이언트에서 HTTP를 호출하는 경우 설정에 따라 다르게 동작합니다.</em></strong></strong><br><img src=\"/2017/09/23/how-cookie-works/http-req-res.png\" title=\"쿠키 생성 과정\"></p>\n<ol>\n<li>최초 HTTP 요청<ul>\n<li>웹브라우저에서 처음 방문하는 웹사이트에 요청을 보냅니다.</li>\n</ul>\n</li>\n<li>세션 ID 발급<ul>\n<li><code>Set-Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; Expires=Fri, 20-Oct-2017 15:24:31 GMT; Path=/</code></li>\n<li><code>Set-Cookie:SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1; Path=/; Secure; HttpOnly</code></li>\n<li><code>Set-Cookie</code> 필드에 대한 상세 정보는 <a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie\" target=\"_blank\" rel=\"noopener\">MDN 문서</a>를 참고해주세요.</li>\n<li><strong><strong><em>[주의] 모든 사이트가 항상 최초의 요청에 세션 ID를 발급하는 것은 아닙니다. 하지만 일반적으로 거의 모든 사이트가 사용자 추적을 위해서 최초 방문시 세션 ID를 발급하며 세션 ID 명이나 값 등의 상세 정책은 사이트마다 다를 수 있습니다.</em></strong></strong></li>\n</ul>\n</li>\n<li>모든 요청 헤더에 Cookie 포함<ul>\n<li><code>Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1</code></li>\n<li>이때 동일한 도메인으로 보내는 모든 요청에 쿠키가 포함되어 요청이 날아갑니다. HTML, CSS, JS, 이미지 등 모든 요청 헤더에 쿠키가 달라붙습니다. 아래 <a href=\"#주의하세요\">상세 내용</a>을 참고해 주세요.</li>\n</ul>\n</li>\n<li>응답 헤더에는 Cookie 미포함</li>\n</ol>\n<h2 id=\"주의하세요\"><a href=\"#주의하세요\" class=\"headerlink\" title=\"주의하세요~\"></a>주의하세요~</h2><p>예전에는 쿠키를 브라우저의 클라이언트 데이터 저장용으로 사용하는 경우도 있었지만 <code>localStorage</code>, <code>sessionStorage</code>(IE8 이상 지원)가 있는 이상 더 이상 쿠키를 데이터 베이스처럼 사용해서는 안됩니다.<br>쿠키는 크기 제한(브라우저 마다 다릅니다.)이 있으며 HTTP 요청을 주고 받을 때 마다 헤더를 통해서 전송이 되므로 성능상 낭비가 일어나게 됩니다.<br>IE8 이전의 시대에는 대안이 없었지만 현재는 IE8 미만의 브라우저는 거의 없으므로 클라이언트 데이터 저장은 용도에 맞게 <code>localStorage</code>, <code>sessionStorage</code>에 저장해야 합니다.</p>\n<p>쿠키의 크기가 1KB, 화면 하나에 HTTP 요청이 10개, 서버에 사용자가 동시에 100명이 동시에 접속한다고 가정하면 서버에 1MB의 불필요한 트래픽이 발생하게 됩니다.<br>동시접속 사용자가 적을 경우는 괜찮지만 서비스가 성장하게 되면 반드시 성능상 문제가 발생하게 됩니다.</p>\n<h2 id=\"쿠키-상세-정보\"><a href=\"#쿠키-상세-정보\" class=\"headerlink\" title=\"쿠키 상세 정보\"></a>쿠키 상세 정보</h2><img src=\"/2017/09/23/how-cookie-works/dev-tools-cookie.png\" title=\"크롬 개발자 도구 Application 탭\">\n<ol>\n<li>Name<ul>\n<li>쿠키 이름(키))</li>\n</ul>\n</li>\n<li>Value<ul>\n<li>쿠키 값</li>\n</ul>\n</li>\n<li>Domain<ul>\n<li>쿠키가 적용될 도메인 정보</li>\n<li>브라우저는 도메인 정보가 같은 쿠키만 요청 헤더에 <code>Cookie</code> 필드를 자동으로 추가 합니다.</li>\n</ul>\n</li>\n<li>Path<ul>\n<li>쿠키를 경로를 지정해서 마치 폴더와 같이 관리할 수 있습니다.</li>\n</ul>\n</li>\n<li>Expires<ul>\n<li><code>Expires</code>에 명시된 날짜에 쿠키가 만료(삭제)됩니다.</li>\n<li><code>Expires</code>, <code>Max-Age</code>가 명시되지 않은 경우 세션 쿠키입니다. 브라우저가 종료되면 해당 쿠키는 삭제됩니다. 하지만 요즘 브라우저들은 종료되었다가 다시 시작되어도 <a href=\"(https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou\">이전 세션을 복원하는 기능</a>이 있어서 세션이 계속 유지되는 경우가 많습니다.</li>\n</ul>\n</li>\n<li>HttpOnly<ul>\n<li><code>HttpOnly</code> 필드가 선언되면 스크립트에서는 해당 쿠키에 접근할 수 없습니다. 하지만 브라우저가 아닌 다른 클라이언트(ex. 크롤러)에서 접근하면 해당 정보를 취득할 수 있습니다.</li>\n</ul>\n</li>\n<li>Secure<ul>\n<li><code>Secure</code> 필드가 선언되면 해당 쿠키는 HTTPS(SSL) 프로토콜을 사용한 경우에만 전송이 됩니다. 하지만 그렇다고 하더라도 절대로 민감한 정보를 담아서는 안됩니다.<br>좀 더 상세한 내용은 MDN에서 한글로 번역된 <a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies\" target=\"_blank\" rel=\"noopener\">상세한 문서</a>를 참고해 주세요.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"쿠키를-이용한-세션관리\"><a href=\"#쿠키를-이용한-세션관리\" class=\"headerlink\" title=\"쿠키를 이용한 세션관리\"></a>쿠키를 이용한 세션관리</h2><p>웹에서는 쿠키를 이용해서 세션을 관리하게 됩니다.<br>쿠키를 이용한 세션관리는 다음 편에서 별도로 설명하겠습니다.</p>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><p><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies\" target=\"_blank\" rel=\"noopener\">MDN HTTP 쿠키</a><br><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie\" target=\"_blank\" rel=\"noopener\">MDN Set-Cookie</a><br><a href=\"https://tools.ietf.org/html/rfc6265#section-4.1\" target=\"_blank\" rel=\"noopener\">RFC-6265</a><br><a href=\"https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou\" target=\"_blank\" rel=\"noopener\">브라우저 세션 복원</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"How-Cookie-Works\"><a href=\"#How-Cookie-Works\" class=\"headerlink\" title=\"How Cookie Works\"></a>How Cookie Works</h1><h2 id=\"Cookie란\"><a href=\"#Cookie란\" class=\"headerlink\" title=\"Cookie란?\"></a>Cookie란?</h2><p>HTTP는 기본적으로 <a href=\"https://ko.wikipedia.org/wiki/무상태_프로토콜\" target=\"_blank\" rel=\"noopener\">무상태 프로토콜</a>입니다.<br>HTTP 서버가 클라이언트에 대한 상태를 가지고 있지 않기 때문에 각각의 요청을 이전 요청과 무관한 독립적인 트랜잭션으로 취급하게 됩니다.<br>하지만 그렇게 되면 세션과 개인화(회원별 서비스)등을 관리할 수 없게 되기 때문에 Cookie(이하 쿠키)를 사용하게 됩니다.</p>\n<p>HTTP의 쿠키는 마치 헨젤과 그레텔의 쿠키(<del>돌맹이나 빵 버전도 있습니다.</del>)와 같습니다.<br>헨젤과 그레텔은 자신들이 돌아갈 길을 잊지 않기 위해서 사용하지만 HTTP의 쿠키는 HTTP 요청을 보내는 클라이언트를 식별하기 위해서 사용합니다.<br><img src=\"/2017/09/23/how-cookie-works/breadcrumbs.jpg\" title=\"헨젤과 그레텔의 쿠키\"></p>\n<h2 id=\"HTTP-메시지\"><a href=\"#HTTP-메시지\" class=\"headerlink\" title=\"HTTP 메시지\"></a>HTTP 메시지</h2><p><strong><strong><em>[주의] 아래 설명은 웹 브라우저를 기반으로 설명한 내용입니다. 서버나 앱, 크롤러 등 다른 클라이언트에서 HTTP를 호출하는 경우 설정에 따라 다르게 동작합니다.</em></strong></strong><br><img src=\"/2017/09/23/how-cookie-works/http-req-res.png\" title=\"쿠키 생성 과정\"></p>\n<ol>\n<li>최초 HTTP 요청<ul>\n<li>웹브라우저에서 처음 방문하는 웹사이트에 요청을 보냅니다.</li>\n</ul>\n</li>\n<li>세션 ID 발급<ul>\n<li><code>Set-Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; Expires=Fri, 20-Oct-2017 15:24:31 GMT; Path=/</code></li>\n<li><code>Set-Cookie:SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1; Path=/; Secure; HttpOnly</code></li>\n<li><code>Set-Cookie</code> 필드에 대한 상세 정보는 <a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie\" target=\"_blank\" rel=\"noopener\">MDN 문서</a>를 참고해주세요.</li>\n<li><strong><strong><em>[주의] 모든 사이트가 항상 최초의 요청에 세션 ID를 발급하는 것은 아닙니다. 하지만 일반적으로 거의 모든 사이트가 사용자 추적을 위해서 최초 방문시 세션 ID를 발급하며 세션 ID 명이나 값 등의 상세 정책은 사이트마다 다를 수 있습니다.</em></strong></strong></li>\n</ul>\n</li>\n<li>모든 요청 헤더에 Cookie 포함<ul>\n<li><code>Cookie:s_u_k=2ecf65a9-3678-497c-a620-640a88cabb44; SESSION=b5e3d1d6-bdcf-4d13-9502-9a9a654d35c1</code></li>\n<li>이때 동일한 도메인으로 보내는 모든 요청에 쿠키가 포함되어 요청이 날아갑니다. HTML, CSS, JS, 이미지 등 모든 요청 헤더에 쿠키가 달라붙습니다. 아래 <a href=\"#주의하세요\">상세 내용</a>을 참고해 주세요.</li>\n</ul>\n</li>\n<li>응답 헤더에는 Cookie 미포함</li>\n</ol>\n<h2 id=\"주의하세요\"><a href=\"#주의하세요\" class=\"headerlink\" title=\"주의하세요~\"></a>주의하세요~</h2><p>예전에는 쿠키를 브라우저의 클라이언트 데이터 저장용으로 사용하는 경우도 있었지만 <code>localStorage</code>, <code>sessionStorage</code>(IE8 이상 지원)가 있는 이상 더 이상 쿠키를 데이터 베이스처럼 사용해서는 안됩니다.<br>쿠키는 크기 제한(브라우저 마다 다릅니다.)이 있으며 HTTP 요청을 주고 받을 때 마다 헤더를 통해서 전송이 되므로 성능상 낭비가 일어나게 됩니다.<br>IE8 이전의 시대에는 대안이 없었지만 현재는 IE8 미만의 브라우저는 거의 없으므로 클라이언트 데이터 저장은 용도에 맞게 <code>localStorage</code>, <code>sessionStorage</code>에 저장해야 합니다.</p>\n<p>쿠키의 크기가 1KB, 화면 하나에 HTTP 요청이 10개, 서버에 사용자가 동시에 100명이 동시에 접속한다고 가정하면 서버에 1MB의 불필요한 트래픽이 발생하게 됩니다.<br>동시접속 사용자가 적을 경우는 괜찮지만 서비스가 성장하게 되면 반드시 성능상 문제가 발생하게 됩니다.</p>\n<h2 id=\"쿠키-상세-정보\"><a href=\"#쿠키-상세-정보\" class=\"headerlink\" title=\"쿠키 상세 정보\"></a>쿠키 상세 정보</h2><img src=\"/2017/09/23/how-cookie-works/dev-tools-cookie.png\" title=\"크롬 개발자 도구 Application 탭\">\n<ol>\n<li>Name<ul>\n<li>쿠키 이름(키))</li>\n</ul>\n</li>\n<li>Value<ul>\n<li>쿠키 값</li>\n</ul>\n</li>\n<li>Domain<ul>\n<li>쿠키가 적용될 도메인 정보</li>\n<li>브라우저는 도메인 정보가 같은 쿠키만 요청 헤더에 <code>Cookie</code> 필드를 자동으로 추가 합니다.</li>\n</ul>\n</li>\n<li>Path<ul>\n<li>쿠키를 경로를 지정해서 마치 폴더와 같이 관리할 수 있습니다.</li>\n</ul>\n</li>\n<li>Expires<ul>\n<li><code>Expires</code>에 명시된 날짜에 쿠키가 만료(삭제)됩니다.</li>\n<li><code>Expires</code>, <code>Max-Age</code>가 명시되지 않은 경우 세션 쿠키입니다. 브라우저가 종료되면 해당 쿠키는 삭제됩니다. 하지만 요즘 브라우저들은 종료되었다가 다시 시작되어도 <a href=\"(https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou\">이전 세션을 복원하는 기능</a>이 있어서 세션이 계속 유지되는 경우가 많습니다.</li>\n</ul>\n</li>\n<li>HttpOnly<ul>\n<li><code>HttpOnly</code> 필드가 선언되면 스크립트에서는 해당 쿠키에 접근할 수 없습니다. 하지만 브라우저가 아닌 다른 클라이언트(ex. 크롤러)에서 접근하면 해당 정보를 취득할 수 있습니다.</li>\n</ul>\n</li>\n<li>Secure<ul>\n<li><code>Secure</code> 필드가 선언되면 해당 쿠키는 HTTPS(SSL) 프로토콜을 사용한 경우에만 전송이 됩니다. 하지만 그렇다고 하더라도 절대로 민감한 정보를 담아서는 안됩니다.<br>좀 더 상세한 내용은 MDN에서 한글로 번역된 <a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies\" target=\"_blank\" rel=\"noopener\">상세한 문서</a>를 참고해 주세요.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"쿠키를-이용한-세션관리\"><a href=\"#쿠키를-이용한-세션관리\" class=\"headerlink\" title=\"쿠키를 이용한 세션관리\"></a>쿠키를 이용한 세션관리</h2><p>웹에서는 쿠키를 이용해서 세션을 관리하게 됩니다.<br>쿠키를 이용한 세션관리는 다음 편에서 별도로 설명하겠습니다.</p>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><p><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies\" target=\"_blank\" rel=\"noopener\">MDN HTTP 쿠키</a><br><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie\" target=\"_blank\" rel=\"noopener\">MDN Set-Cookie</a><br><a href=\"https://tools.ietf.org/html/rfc6265#section-4.1\" target=\"_blank\" rel=\"noopener\">RFC-6265</a><br><a href=\"https://support.mozilla.org/ko/kb/restore-previous-session#w_eieo-hiuayi-ykiiaooe-hlou\" target=\"_blank\" rel=\"noopener\">브라우저 세션 복원</a></p>\n"},{"title":"server-network-perf","date":"2017-09-21T00:30:48.000Z","_content":"\n# 서버 네트워크 속도(대역폭) 측정하기\n\n{% asset_img 'highway-393492_1920.jpg' '우리는 항상 빠른 속도를 원한다.' %}\n\nAWS는 [EC2 인스턴스 타입](https://aws.amazon.com/ko/ec2/instance-types/)별 네트워크 속도(대역폭)에 대한 정확한 수치를 공개하고 있지 않습니다.\n아마도 자원을 공유하는 클라우드의 특성상 정확한 네트워크 속도를 보장하기 어렵기 때문이 아닌가 추측됩니다.\n__***[2017-09-23] 정정합니다. [AWS ec2 인스턴스 구성](http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html)을 보면 대역폭이 나와있습니다. 하지만 T2 인스턴스는 해당 표에 없습니다.***__\n\n어쨌든 우리도 서버의 대략적인 네트워크 대역폭을 알아야 실수 없이 서버를 구성할 수 있으니 한 번 측정을 해보도록 하겠습니다.\n측정 도구로는 [iperf](https://iperf.fr/)를 사용하도록 하겠습니다.\n\n## 준비물\n1. 클라이언트 PC 1대(간단하게 그냥 Macbook Pro와 일반 가정용 인터넷을 사용했습니다.)\n1. 서버(AWS EC2 t2.medium) 1대\n\n## iperf 설치하기\n1. 클라이언트\n  1. ``$ brew install iperf``\n1. 서버\n  1. ``$ sudo yum install iperf``\n\n## iperf 테스트하기\n1. 서버\n  1. ``$ iperf -s``\n  1. 옵션설명\n    * -s: iperf가 서버모드로 실행됩니다.\n1. 클라이언트\n  1. ``$ iperf -c ${SERVER_IP} -i 1 -t 10``\n  1. 옵션설명\n    * -c: 클라이언트 모드로 실행\n    * ${SERVER_IP}: 테스트할 서버의 IP\n    * -i 1: 반복 시간 간격(초단위)\n    * -t: 테스트할 시간(초단위)\n\n### 서버로그\n```\n$ iperf -s\n------------------------------------------------------------\nServer listening on TCP port 5001\nTCP window size: 85.3 KByte (default)\n------------------------------------------------------------\n[  4] local 172.31.25.62 port 5001 connected with 115.140.62.214 port 56015\n[ ID] Interval       Transfer     Bandwidth\n[  4]  0.0-10.1 sec  29.3 MBytes  24.2 Mbits/sec\n```\n\n### 클라이언트 로그\n```\n$ iperf -c ###.###.###.### -i 1 -t 10\n------------------------------------------------------------\nClient connecting to ###.###.###.###, TCP port 5001\nTCP window size:  129 KByte (default)\n------------------------------------------------------------\n[  4] local 192.168.219.121 port 61977 connected with ###.###.###.### port 5001\n[ ID] Interval       Transfer     Bandwidth\n[  4]  0.0- 1.0 sec  4.00 MBytes  33.6 Mbits/sec\n[  4]  1.0- 2.0 sec  3.38 MBytes  28.3 Mbits/sec\n[  4]  2.0- 3.0 sec  3.38 MBytes  28.3 Mbits/sec\n[  4]  3.0- 4.0 sec  3.50 MBytes  29.4 Mbits/sec\n[  4]  4.0- 5.0 sec  2.38 MBytes  19.9 Mbits/sec\n[  4]  5.0- 6.0 sec  4.12 MBytes  34.6 Mbits/sec\n[  4]  6.0- 7.0 sec  3.88 MBytes  32.5 Mbits/sec\n[  4]  7.0- 8.0 sec  4.12 MBytes  34.6 Mbits/sec\n[  4]  8.0- 9.0 sec  3.75 MBytes  31.5 Mbits/sec\n[  4]  9.0-10.0 sec  4.50 MBytes  37.7 Mbits/sec\n[  4]  0.0-10.0 sec  37.1 MBytes  31.1 Mbits/sec\n```\n\n## 테스트 결과 읽기\n1. ``Interval``: 호출한 시간 간격\n1. ``Transfer``: 전송한 데이터 사이즈\n1. ``Bandwidth``: 측정된 대역폭(주의: 단위가 Mbits 임. Mbits / 8 === MB)\n\n## 관련자료\n[iperf](https://iperf.fr/)\n[AWS ec2 인스턴스 타입](https://aws.amazon.com/ko/ec2/instance-types/)\n[AWS ec2 인스턴스 구성](http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html)","source":"_posts/server-network-perf.md","raw":"---\ntitle: server-network-perf\ndate: 2017-09-21 09:30:48\ntags:\n---\n\n# 서버 네트워크 속도(대역폭) 측정하기\n\n{% asset_img 'highway-393492_1920.jpg' '우리는 항상 빠른 속도를 원한다.' %}\n\nAWS는 [EC2 인스턴스 타입](https://aws.amazon.com/ko/ec2/instance-types/)별 네트워크 속도(대역폭)에 대한 정확한 수치를 공개하고 있지 않습니다.\n아마도 자원을 공유하는 클라우드의 특성상 정확한 네트워크 속도를 보장하기 어렵기 때문이 아닌가 추측됩니다.\n__***[2017-09-23] 정정합니다. [AWS ec2 인스턴스 구성](http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html)을 보면 대역폭이 나와있습니다. 하지만 T2 인스턴스는 해당 표에 없습니다.***__\n\n어쨌든 우리도 서버의 대략적인 네트워크 대역폭을 알아야 실수 없이 서버를 구성할 수 있으니 한 번 측정을 해보도록 하겠습니다.\n측정 도구로는 [iperf](https://iperf.fr/)를 사용하도록 하겠습니다.\n\n## 준비물\n1. 클라이언트 PC 1대(간단하게 그냥 Macbook Pro와 일반 가정용 인터넷을 사용했습니다.)\n1. 서버(AWS EC2 t2.medium) 1대\n\n## iperf 설치하기\n1. 클라이언트\n  1. ``$ brew install iperf``\n1. 서버\n  1. ``$ sudo yum install iperf``\n\n## iperf 테스트하기\n1. 서버\n  1. ``$ iperf -s``\n  1. 옵션설명\n    * -s: iperf가 서버모드로 실행됩니다.\n1. 클라이언트\n  1. ``$ iperf -c ${SERVER_IP} -i 1 -t 10``\n  1. 옵션설명\n    * -c: 클라이언트 모드로 실행\n    * ${SERVER_IP}: 테스트할 서버의 IP\n    * -i 1: 반복 시간 간격(초단위)\n    * -t: 테스트할 시간(초단위)\n\n### 서버로그\n```\n$ iperf -s\n------------------------------------------------------------\nServer listening on TCP port 5001\nTCP window size: 85.3 KByte (default)\n------------------------------------------------------------\n[  4] local 172.31.25.62 port 5001 connected with 115.140.62.214 port 56015\n[ ID] Interval       Transfer     Bandwidth\n[  4]  0.0-10.1 sec  29.3 MBytes  24.2 Mbits/sec\n```\n\n### 클라이언트 로그\n```\n$ iperf -c ###.###.###.### -i 1 -t 10\n------------------------------------------------------------\nClient connecting to ###.###.###.###, TCP port 5001\nTCP window size:  129 KByte (default)\n------------------------------------------------------------\n[  4] local 192.168.219.121 port 61977 connected with ###.###.###.### port 5001\n[ ID] Interval       Transfer     Bandwidth\n[  4]  0.0- 1.0 sec  4.00 MBytes  33.6 Mbits/sec\n[  4]  1.0- 2.0 sec  3.38 MBytes  28.3 Mbits/sec\n[  4]  2.0- 3.0 sec  3.38 MBytes  28.3 Mbits/sec\n[  4]  3.0- 4.0 sec  3.50 MBytes  29.4 Mbits/sec\n[  4]  4.0- 5.0 sec  2.38 MBytes  19.9 Mbits/sec\n[  4]  5.0- 6.0 sec  4.12 MBytes  34.6 Mbits/sec\n[  4]  6.0- 7.0 sec  3.88 MBytes  32.5 Mbits/sec\n[  4]  7.0- 8.0 sec  4.12 MBytes  34.6 Mbits/sec\n[  4]  8.0- 9.0 sec  3.75 MBytes  31.5 Mbits/sec\n[  4]  9.0-10.0 sec  4.50 MBytes  37.7 Mbits/sec\n[  4]  0.0-10.0 sec  37.1 MBytes  31.1 Mbits/sec\n```\n\n## 테스트 결과 읽기\n1. ``Interval``: 호출한 시간 간격\n1. ``Transfer``: 전송한 데이터 사이즈\n1. ``Bandwidth``: 측정된 대역폭(주의: 단위가 Mbits 임. Mbits / 8 === MB)\n\n## 관련자료\n[iperf](https://iperf.fr/)\n[AWS ec2 인스턴스 타입](https://aws.amazon.com/ko/ec2/instance-types/)\n[AWS ec2 인스턴스 구성](http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html)","slug":"server-network-perf","published":1,"updated":"2018-02-19T08:40:12.741Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjdu1d4it00025707z503pmvf","content":"<h1 id=\"서버-네트워크-속도-대역폭-측정하기\"><a href=\"#서버-네트워크-속도-대역폭-측정하기\" class=\"headerlink\" title=\"서버 네트워크 속도(대역폭) 측정하기\"></a>서버 네트워크 속도(대역폭) 측정하기</h1><img src=\"/2017/09/21/server-network-perf/highway-393492_1920.jpg\" title=\"우리는 항상 빠른 속도를 원한다.\">\n<p>AWS는 <a href=\"https://aws.amazon.com/ko/ec2/instance-types/\" target=\"_blank\" rel=\"noopener\">EC2 인스턴스 타입</a>별 네트워크 속도(대역폭)에 대한 정확한 수치를 공개하고 있지 않습니다.<br>아마도 자원을 공유하는 클라우드의 특성상 정확한 네트워크 속도를 보장하기 어렵기 때문이 아닌가 추측됩니다.<br><strong><strong><em>[2017-09-23] 정정합니다. <a href=\"http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html\" target=\"_blank\" rel=\"noopener\">AWS ec2 인스턴스 구성</a>을 보면 대역폭이 나와있습니다. 하지만 T2 인스턴스는 해당 표에 없습니다.</em></strong></strong></p>\n<p>어쨌든 우리도 서버의 대략적인 네트워크 대역폭을 알아야 실수 없이 서버를 구성할 수 있으니 한 번 측정을 해보도록 하겠습니다.<br>측정 도구로는 <a href=\"https://iperf.fr/\" target=\"_blank\" rel=\"noopener\">iperf</a>를 사용하도록 하겠습니다.</p>\n<h2 id=\"준비물\"><a href=\"#준비물\" class=\"headerlink\" title=\"준비물\"></a>준비물</h2><ol>\n<li>클라이언트 PC 1대(간단하게 그냥 Macbook Pro와 일반 가정용 인터넷을 사용했습니다.)</li>\n<li>서버(AWS EC2 t2.medium) 1대</li>\n</ol>\n<h2 id=\"iperf-설치하기\"><a href=\"#iperf-설치하기\" class=\"headerlink\" title=\"iperf 설치하기\"></a>iperf 설치하기</h2><ol>\n<li>클라이언트<ol>\n<li><code>$ brew install iperf</code></li>\n</ol>\n</li>\n<li>서버<ol>\n<li><code>$ sudo yum install iperf</code></li>\n</ol>\n</li>\n</ol>\n<h2 id=\"iperf-테스트하기\"><a href=\"#iperf-테스트하기\" class=\"headerlink\" title=\"iperf 테스트하기\"></a>iperf 테스트하기</h2><ol>\n<li>서버<ol>\n<li><code>$ iperf -s</code></li>\n<li>옵션설명<ul>\n<li>-s: iperf가 서버모드로 실행됩니다.</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>클라이언트<ol>\n<li><code>$ iperf -c ${SERVER_IP} -i 1 -t 10</code></li>\n<li>옵션설명<ul>\n<li>-c: 클라이언트 모드로 실행</li>\n<li>${SERVER_IP}: 테스트할 서버의 IP</li>\n<li>-i 1: 반복 시간 간격(초단위)</li>\n<li>-t: 테스트할 시간(초단위)</li>\n</ul>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"서버로그\"><a href=\"#서버로그\" class=\"headerlink\" title=\"서버로그\"></a>서버로그</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iperf -s</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Server listening on TCP port 5001</span><br><span class=\"line\">TCP window size: 85.3 KByte (default)</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">[  4] local 172.31.25.62 port 5001 connected with 115.140.62.214 port 56015</span><br><span class=\"line\">[ ID] Interval       Transfer     Bandwidth</span><br><span class=\"line\">[  4]  0.0-10.1 sec  29.3 MBytes  24.2 Mbits/sec</span><br></pre></td></tr></table></figure>\n<h3 id=\"클라이언트-로그\"><a href=\"#클라이언트-로그\" class=\"headerlink\" title=\"클라이언트 로그\"></a>클라이언트 로그</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iperf -c ###.###.###.### -i 1 -t 10</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Client connecting to ###.###.###.###, TCP port 5001</span><br><span class=\"line\">TCP window size:  129 KByte (default)</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">[  4] local 192.168.219.121 port 61977 connected with ###.###.###.### port 5001</span><br><span class=\"line\">[ ID] Interval       Transfer     Bandwidth</span><br><span class=\"line\">[  4]  0.0- 1.0 sec  4.00 MBytes  33.6 Mbits/sec</span><br><span class=\"line\">[  4]  1.0- 2.0 sec  3.38 MBytes  28.3 Mbits/sec</span><br><span class=\"line\">[  4]  2.0- 3.0 sec  3.38 MBytes  28.3 Mbits/sec</span><br><span class=\"line\">[  4]  3.0- 4.0 sec  3.50 MBytes  29.4 Mbits/sec</span><br><span class=\"line\">[  4]  4.0- 5.0 sec  2.38 MBytes  19.9 Mbits/sec</span><br><span class=\"line\">[  4]  5.0- 6.0 sec  4.12 MBytes  34.6 Mbits/sec</span><br><span class=\"line\">[  4]  6.0- 7.0 sec  3.88 MBytes  32.5 Mbits/sec</span><br><span class=\"line\">[  4]  7.0- 8.0 sec  4.12 MBytes  34.6 Mbits/sec</span><br><span class=\"line\">[  4]  8.0- 9.0 sec  3.75 MBytes  31.5 Mbits/sec</span><br><span class=\"line\">[  4]  9.0-10.0 sec  4.50 MBytes  37.7 Mbits/sec</span><br><span class=\"line\">[  4]  0.0-10.0 sec  37.1 MBytes  31.1 Mbits/sec</span><br></pre></td></tr></table></figure>\n<h2 id=\"테스트-결과-읽기\"><a href=\"#테스트-결과-읽기\" class=\"headerlink\" title=\"테스트 결과 읽기\"></a>테스트 결과 읽기</h2><ol>\n<li><code>Interval</code>: 호출한 시간 간격</li>\n<li><code>Transfer</code>: 전송한 데이터 사이즈</li>\n<li><code>Bandwidth</code>: 측정된 대역폭(주의: 단위가 Mbits 임. Mbits / 8 === MB)</li>\n</ol>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><p><a href=\"https://iperf.fr/\" target=\"_blank\" rel=\"noopener\">iperf</a><br><a href=\"https://aws.amazon.com/ko/ec2/instance-types/\" target=\"_blank\" rel=\"noopener\">AWS ec2 인스턴스 타입</a><br><a href=\"http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html\" target=\"_blank\" rel=\"noopener\">AWS ec2 인스턴스 구성</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"서버-네트워크-속도-대역폭-측정하기\"><a href=\"#서버-네트워크-속도-대역폭-측정하기\" class=\"headerlink\" title=\"서버 네트워크 속도(대역폭) 측정하기\"></a>서버 네트워크 속도(대역폭) 측정하기</h1><img src=\"/2017/09/21/server-network-perf/highway-393492_1920.jpg\" title=\"우리는 항상 빠른 속도를 원한다.\">\n<p>AWS는 <a href=\"https://aws.amazon.com/ko/ec2/instance-types/\" target=\"_blank\" rel=\"noopener\">EC2 인스턴스 타입</a>별 네트워크 속도(대역폭)에 대한 정확한 수치를 공개하고 있지 않습니다.<br>아마도 자원을 공유하는 클라우드의 특성상 정확한 네트워크 속도를 보장하기 어렵기 때문이 아닌가 추측됩니다.<br><strong><strong><em>[2017-09-23] 정정합니다. <a href=\"http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html\" target=\"_blank\" rel=\"noopener\">AWS ec2 인스턴스 구성</a>을 보면 대역폭이 나와있습니다. 하지만 T2 인스턴스는 해당 표에 없습니다.</em></strong></strong></p>\n<p>어쨌든 우리도 서버의 대략적인 네트워크 대역폭을 알아야 실수 없이 서버를 구성할 수 있으니 한 번 측정을 해보도록 하겠습니다.<br>측정 도구로는 <a href=\"https://iperf.fr/\" target=\"_blank\" rel=\"noopener\">iperf</a>를 사용하도록 하겠습니다.</p>\n<h2 id=\"준비물\"><a href=\"#준비물\" class=\"headerlink\" title=\"준비물\"></a>준비물</h2><ol>\n<li>클라이언트 PC 1대(간단하게 그냥 Macbook Pro와 일반 가정용 인터넷을 사용했습니다.)</li>\n<li>서버(AWS EC2 t2.medium) 1대</li>\n</ol>\n<h2 id=\"iperf-설치하기\"><a href=\"#iperf-설치하기\" class=\"headerlink\" title=\"iperf 설치하기\"></a>iperf 설치하기</h2><ol>\n<li>클라이언트<ol>\n<li><code>$ brew install iperf</code></li>\n</ol>\n</li>\n<li>서버<ol>\n<li><code>$ sudo yum install iperf</code></li>\n</ol>\n</li>\n</ol>\n<h2 id=\"iperf-테스트하기\"><a href=\"#iperf-테스트하기\" class=\"headerlink\" title=\"iperf 테스트하기\"></a>iperf 테스트하기</h2><ol>\n<li>서버<ol>\n<li><code>$ iperf -s</code></li>\n<li>옵션설명<ul>\n<li>-s: iperf가 서버모드로 실행됩니다.</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>클라이언트<ol>\n<li><code>$ iperf -c ${SERVER_IP} -i 1 -t 10</code></li>\n<li>옵션설명<ul>\n<li>-c: 클라이언트 모드로 실행</li>\n<li>${SERVER_IP}: 테스트할 서버의 IP</li>\n<li>-i 1: 반복 시간 간격(초단위)</li>\n<li>-t: 테스트할 시간(초단위)</li>\n</ul>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"서버로그\"><a href=\"#서버로그\" class=\"headerlink\" title=\"서버로그\"></a>서버로그</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iperf -s</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Server listening on TCP port 5001</span><br><span class=\"line\">TCP window size: 85.3 KByte (default)</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">[  4] local 172.31.25.62 port 5001 connected with 115.140.62.214 port 56015</span><br><span class=\"line\">[ ID] Interval       Transfer     Bandwidth</span><br><span class=\"line\">[  4]  0.0-10.1 sec  29.3 MBytes  24.2 Mbits/sec</span><br></pre></td></tr></table></figure>\n<h3 id=\"클라이언트-로그\"><a href=\"#클라이언트-로그\" class=\"headerlink\" title=\"클라이언트 로그\"></a>클라이언트 로그</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iperf -c ###.###.###.### -i 1 -t 10</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Client connecting to ###.###.###.###, TCP port 5001</span><br><span class=\"line\">TCP window size:  129 KByte (default)</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">[  4] local 192.168.219.121 port 61977 connected with ###.###.###.### port 5001</span><br><span class=\"line\">[ ID] Interval       Transfer     Bandwidth</span><br><span class=\"line\">[  4]  0.0- 1.0 sec  4.00 MBytes  33.6 Mbits/sec</span><br><span class=\"line\">[  4]  1.0- 2.0 sec  3.38 MBytes  28.3 Mbits/sec</span><br><span class=\"line\">[  4]  2.0- 3.0 sec  3.38 MBytes  28.3 Mbits/sec</span><br><span class=\"line\">[  4]  3.0- 4.0 sec  3.50 MBytes  29.4 Mbits/sec</span><br><span class=\"line\">[  4]  4.0- 5.0 sec  2.38 MBytes  19.9 Mbits/sec</span><br><span class=\"line\">[  4]  5.0- 6.0 sec  4.12 MBytes  34.6 Mbits/sec</span><br><span class=\"line\">[  4]  6.0- 7.0 sec  3.88 MBytes  32.5 Mbits/sec</span><br><span class=\"line\">[  4]  7.0- 8.0 sec  4.12 MBytes  34.6 Mbits/sec</span><br><span class=\"line\">[  4]  8.0- 9.0 sec  3.75 MBytes  31.5 Mbits/sec</span><br><span class=\"line\">[  4]  9.0-10.0 sec  4.50 MBytes  37.7 Mbits/sec</span><br><span class=\"line\">[  4]  0.0-10.0 sec  37.1 MBytes  31.1 Mbits/sec</span><br></pre></td></tr></table></figure>\n<h2 id=\"테스트-결과-읽기\"><a href=\"#테스트-결과-읽기\" class=\"headerlink\" title=\"테스트 결과 읽기\"></a>테스트 결과 읽기</h2><ol>\n<li><code>Interval</code>: 호출한 시간 간격</li>\n<li><code>Transfer</code>: 전송한 데이터 사이즈</li>\n<li><code>Bandwidth</code>: 측정된 대역폭(주의: 단위가 Mbits 임. Mbits / 8 === MB)</li>\n</ol>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><p><a href=\"https://iperf.fr/\" target=\"_blank\" rel=\"noopener\">iperf</a><br><a href=\"https://aws.amazon.com/ko/ec2/instance-types/\" target=\"_blank\" rel=\"noopener\">AWS ec2 인스턴스 타입</a><br><a href=\"http://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-ec2-config.html\" target=\"_blank\" rel=\"noopener\">AWS ec2 인스턴스 구성</a></p>\n"},{"title":"ts-ios-wifi-webkit-error","date":"2017-08-24T10:17:22.000Z","_content":"\n# [Trouble Shooting] iOS WiFi parse error\n\n## 증상\n1. iOS 사파리에서 [가자고](https://www.thegajago.com) 사이트를 열면 ``오류: WebKit에 내부 오류 발생``이라고 보여진다.\n  - {% asset_img 'webkit-error.png' '우리는 항상 빠른 속도를 원한다.' %}\n2. 사이트의 반응이 매우 느리며 불특정 페이지에서 발생한다.\n3. WiFi 연결일때만 발생하며 LTE 연결인 경우 오류가 발생하지 않는다.\n4. iOS 10.2 버전 업데이트 이후부터 발생된다.\n\n\n## 원인\n1. iOS WiFi 연결상태에서 gzip decoding에 뭔가 문제가 있는것 같다.\n  - 사실 정확한 원인 및 문서를 찾지 못했다.\n\n\n## 해결책\n1. gzip 옵션을 off 한다.\n```conf\n...\n    gzip on; // -> off\n    gzip_types text/plain application/xml text/css text/js text/xml application/x-javascript text/javascript application/json appplication/xml+rss;\n    gzip_http_version 1.1;\n    gzip_disable \"MSIE [1-6] \\.\";\n    gzip_vary on;\n...\n```\n\n\n## 남아있는 과제\n1. nginx gzip 모듈 버전을 업데이트하면 괜찮지 않을까?\n2. gzip을 iOS에서만 off 하도록 gzip_disable 값을 셋팅하자.\n\n## 관련자료\n- 없음","source":"_posts/ts-ios-wifi-webkit-error.md","raw":"---\ntitle: ts-ios-wifi-webkit-error\ndate: 2017-08-24 19:17:22\ntags:\n---\n\n# [Trouble Shooting] iOS WiFi parse error\n\n## 증상\n1. iOS 사파리에서 [가자고](https://www.thegajago.com) 사이트를 열면 ``오류: WebKit에 내부 오류 발생``이라고 보여진다.\n  - {% asset_img 'webkit-error.png' '우리는 항상 빠른 속도를 원한다.' %}\n2. 사이트의 반응이 매우 느리며 불특정 페이지에서 발생한다.\n3. WiFi 연결일때만 발생하며 LTE 연결인 경우 오류가 발생하지 않는다.\n4. iOS 10.2 버전 업데이트 이후부터 발생된다.\n\n\n## 원인\n1. iOS WiFi 연결상태에서 gzip decoding에 뭔가 문제가 있는것 같다.\n  - 사실 정확한 원인 및 문서를 찾지 못했다.\n\n\n## 해결책\n1. gzip 옵션을 off 한다.\n```conf\n...\n    gzip on; // -> off\n    gzip_types text/plain application/xml text/css text/js text/xml application/x-javascript text/javascript application/json appplication/xml+rss;\n    gzip_http_version 1.1;\n    gzip_disable \"MSIE [1-6] \\.\";\n    gzip_vary on;\n...\n```\n\n\n## 남아있는 과제\n1. nginx gzip 모듈 버전을 업데이트하면 괜찮지 않을까?\n2. gzip을 iOS에서만 off 하도록 gzip_disable 값을 셋팅하자.\n\n## 관련자료\n- 없음","slug":"ts-ios-wifi-webkit-error","published":1,"updated":"2018-02-19T08:40:12.744Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjdu1d4ix00045707emb3haie","content":"<h1 id=\"Trouble-Shooting-iOS-WiFi-parse-error\"><a href=\"#Trouble-Shooting-iOS-WiFi-parse-error\" class=\"headerlink\" title=\"[Trouble Shooting] iOS WiFi parse error\"></a>[Trouble Shooting] iOS WiFi parse error</h1><h2 id=\"증상\"><a href=\"#증상\" class=\"headerlink\" title=\"증상\"></a>증상</h2><ol>\n<li>iOS 사파리에서 <a href=\"https://www.thegajago.com\" target=\"_blank\" rel=\"noopener\">가자고</a> 사이트를 열면 <code>오류: WebKit에 내부 오류 발생</code>이라고 보여진다.<ul>\n<li><img src=\"/2017/08/24/ts-ios-wifi-webkit-error/webkit-error.png\" title=\"우리는 항상 빠른 속도를 원한다.\"></li>\n</ul>\n</li>\n<li>사이트의 반응이 매우 느리며 불특정 페이지에서 발생한다.</li>\n<li>WiFi 연결일때만 발생하며 LTE 연결인 경우 오류가 발생하지 않는다.</li>\n<li>iOS 10.2 버전 업데이트 이후부터 발생된다.</li>\n</ol>\n<h2 id=\"원인\"><a href=\"#원인\" class=\"headerlink\" title=\"원인\"></a>원인</h2><ol>\n<li>iOS WiFi 연결상태에서 gzip decoding에 뭔가 문제가 있는것 같다.<ul>\n<li>사실 정확한 원인 및 문서를 찾지 못했다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"해결책\"><a href=\"#해결책\" class=\"headerlink\" title=\"해결책\"></a>해결책</h2><ol>\n<li>gzip 옵션을 off 한다.<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    gzip on; // -&gt; off</span><br><span class=\"line\">    gzip_types text/plain application/xml text/css text/js text/xml application/x-javascript text/javascript application/json appplication/xml+rss;</span><br><span class=\"line\">    gzip_http_version 1.1;</span><br><span class=\"line\">    gzip_disable &quot;MSIE [1-6] \\.&quot;;</span><br><span class=\"line\">    gzip_vary on;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"남아있는-과제\"><a href=\"#남아있는-과제\" class=\"headerlink\" title=\"남아있는 과제\"></a>남아있는 과제</h2><ol>\n<li>nginx gzip 모듈 버전을 업데이트하면 괜찮지 않을까?</li>\n<li>gzip을 iOS에서만 off 하도록 gzip_disable 값을 셋팅하자.</li>\n</ol>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><ul>\n<li>없음</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Trouble-Shooting-iOS-WiFi-parse-error\"><a href=\"#Trouble-Shooting-iOS-WiFi-parse-error\" class=\"headerlink\" title=\"[Trouble Shooting] iOS WiFi parse error\"></a>[Trouble Shooting] iOS WiFi parse error</h1><h2 id=\"증상\"><a href=\"#증상\" class=\"headerlink\" title=\"증상\"></a>증상</h2><ol>\n<li>iOS 사파리에서 <a href=\"https://www.thegajago.com\" target=\"_blank\" rel=\"noopener\">가자고</a> 사이트를 열면 <code>오류: WebKit에 내부 오류 발생</code>이라고 보여진다.<ul>\n<li><img src=\"/2017/08/24/ts-ios-wifi-webkit-error/webkit-error.png\" title=\"우리는 항상 빠른 속도를 원한다.\"></li>\n</ul>\n</li>\n<li>사이트의 반응이 매우 느리며 불특정 페이지에서 발생한다.</li>\n<li>WiFi 연결일때만 발생하며 LTE 연결인 경우 오류가 발생하지 않는다.</li>\n<li>iOS 10.2 버전 업데이트 이후부터 발생된다.</li>\n</ol>\n<h2 id=\"원인\"><a href=\"#원인\" class=\"headerlink\" title=\"원인\"></a>원인</h2><ol>\n<li>iOS WiFi 연결상태에서 gzip decoding에 뭔가 문제가 있는것 같다.<ul>\n<li>사실 정확한 원인 및 문서를 찾지 못했다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"해결책\"><a href=\"#해결책\" class=\"headerlink\" title=\"해결책\"></a>해결책</h2><ol>\n<li>gzip 옵션을 off 한다.<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    gzip on; // -&gt; off</span><br><span class=\"line\">    gzip_types text/plain application/xml text/css text/js text/xml application/x-javascript text/javascript application/json appplication/xml+rss;</span><br><span class=\"line\">    gzip_http_version 1.1;</span><br><span class=\"line\">    gzip_disable &quot;MSIE [1-6] \\.&quot;;</span><br><span class=\"line\">    gzip_vary on;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"남아있는-과제\"><a href=\"#남아있는-과제\" class=\"headerlink\" title=\"남아있는 과제\"></a>남아있는 과제</h2><ol>\n<li>nginx gzip 모듈 버전을 업데이트하면 괜찮지 않을까?</li>\n<li>gzip을 iOS에서만 off 하도록 gzip_disable 값을 셋팅하자.</li>\n</ol>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><ul>\n<li>없음</li>\n</ul>\n"},{"title":"ts-spring-session-oome","date":"2017-08-24T07:20:28.000Z","_content":"\n# [Trouble Shooting] spring-session OOME\n\n## 증상\n1. 2번 서버가 OutOfMemoryError로 갑자기 죽어버렸음\n2. KT 로드밸런서가 2번 서버로 계속 요청을 보냄\n3. 사용자의 요청이 1번 서버로만 간 경우 정상적으로 서비스를 이용\n4. 사용자의 요청이 2번으로 하나라도 가면 API의 응답을 받지 못함\n\n```log\n2017-08-04 19:40:51 [gajago-front] [redisMessageListenerContainer-1] ERROR org.springframework.data.redis.listener.RedisMessageListenerContainer:handleSubscriptionException:648 - SubscriptionTask aborted with exception:\njava.lang.OutOfMemoryError: unable to create new native thread\n        at java.lang.Thread.start0(Native Method)\n        at java.lang.Thread.start(Thread.java:714)\n        at org.springframework.core.task.SimpleAsyncTaskExecutor.doExecute(SimpleAsyncTaskExecutor.java:213)\n        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:171)\n        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:151)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer.dispatchMessage(RedisMessageListenerContainer.java:958)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer.access$1400(RedisMessageListenerContainer.java:71)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer$DispatchMessageListener.onMessage(RedisMessageListenerContainer.java:949)\n        at org.springframework.data.redis.connection.jedis.JedisMessageListener.onPMessage(JedisMessageListener.java:43)\n        at redis.clients.jedis.BinaryJedisPubSub.process(BinaryJedisPubSub.java:109)\n        at redis.clients.jedis.BinaryJedisPubSub.proceedWithPatterns(BinaryJedisPubSub.java:75)\n        at redis.clients.jedis.BinaryJedis.psubscribe(BinaryJedis.java:2953)\n        at org.springframework.data.redis.connection.jedis.JedisConnection.pSubscribe(JedisConnection.java:2959)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.eventuallyPerformSubscription(RedisMessageListenerContainer.java:773)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.run(RedisMessageListenerContainer.java:740)\n        at java.lang.Thread.run(Thread.java:745)\nException in thread \"http-apr-10090-Acceptor-0\" java.lang.OutOfMemoryError: unable to create new native thread\n        at java.lang.Thread.start0(Native Method)\n        at java.lang.Thread.start(Thread.java:714)\n        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:950)\n        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1368)\n        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:161)\n        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:141)\n        at org.apache.catalina.core.StandardThreadExecutor.execute(StandardThreadExecutor.java:169)\n        at org.apache.tomcat.util.net.AprEndpoint.processSocketWithOptions(AprEndpoint.java:909)\n        at org.apache.tomcat.util.net.AprEndpoint$Acceptor.run(AprEndpoint.java:1086)\n        at java.lang.Thread.run(Thread.java:745)\n```\n\n## 원인\n1. [spring-session](https://github.com/spring-projects/spring-session)에서 [spring-data-redis]를 사용할 때 [RedisMessageListenerContainer의 taskExecutor](https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L97)에 별도의 값을 설정하지 않아서 [SimpleAsyncTaskExecutor](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java)를 사용하고 있음\n2. [SimpleAsyncTaskExecutor 문서](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html)에서 이 클래스는 쓰레드를 재사용하지 않으니 실행시간이 짧은 많은 수의 작업에는 사용하지 말라고 권장하고 있음\n    - ``NOTE: This implementation does not reuse threads! Consider a thread-pooling TaskExecutor implementation instead, in particular for executing a large number of short-lived tasks.``\n3. spring-session에서 세션정보에 접근하기 위해서 redis를 사용할 때 마다 Thread가 매번 생성됨\n4. 접속량이 많이지게 되면 ``OutOfMemoryError`` 발생\n\n## 해결책\n1. SimpleAsyncTaskExecutor 대신에 ThreadPool을 사용할 수 있도록 지정한다\n2. 하지만 지금 사용중인 ``spring-session-1.0.2.RELEASE`` 버전에서는 taskExecutor를 별도로 지정할 수 있는 방법이 없음\n3. 결국 ``spring-session-1.3.1.RELEASE`` 버전으로 업데이트\n4. [패치된 내용](https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92)을 바탕으로 ``springSessionRedisTaskExecutor``를 지정\n5. ``springSessionRedisTaskExecutor``를 지정하면 일어나는 일\n  1. ``springSessionRedisTaskExecutor``를 지정하면 ``RedisHttpSessionConfiguration.redisTaskExecutor``에 지정한 ``springSessionRedisTaskExecutor``가 할당 됨 [소스코드](https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L203)\n  2. ``RedisMessageListenerContainer.taskExecutor``에 ``RedisHttpSessionConfiguration.redisTaskExecutor``가 할당 됨 [소스코드](https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L93)\n  3. spring-session에서 redis를 사용할 때 ``springSessionRedisTaskExecutor``를 사용하게 됨 [소스코드](https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L961)\n\n```java\n@Configuration\npublic class FrontSessionConfig {\n    @Bean\n    public Executor springSessionRedisTaskExecutor() {\n        ThreadFactory threadFactory = new ThreadFactory() {\n            private int threadCount = 0;\n\n            @Override\n            public Thread newThread(Runnable runnable) {\n                return new Thread(runnable, String.format(\"gajago-session-redis-%d\", ++threadCount));\n            }\n        };\n\n        return Executors.newCachedThreadPool(threadFactory);\n    }\n}\n```\n\n\n## 남아있는 과제\n1. 왜 1번 서버는 안 죽고 2번 서버만 죽었을까?\n2. KT 로드밸런서가 왜 2번 서버로 계속 요청을 보냈을까?\n3. 캐시로 사용하고 있는 redis의 taskExecutor는?\n\n## 관련자료\n* https://github.com/spring-projects/spring-session\n* https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92\n* https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java\n* https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html\n","source":"_posts/ts-spring-session-oome.md","raw":"---\ntitle: ts-spring-session-oome\ndate: 2017-08-24 16:20:28\ntags:\n---\n\n# [Trouble Shooting] spring-session OOME\n\n## 증상\n1. 2번 서버가 OutOfMemoryError로 갑자기 죽어버렸음\n2. KT 로드밸런서가 2번 서버로 계속 요청을 보냄\n3. 사용자의 요청이 1번 서버로만 간 경우 정상적으로 서비스를 이용\n4. 사용자의 요청이 2번으로 하나라도 가면 API의 응답을 받지 못함\n\n```log\n2017-08-04 19:40:51 [gajago-front] [redisMessageListenerContainer-1] ERROR org.springframework.data.redis.listener.RedisMessageListenerContainer:handleSubscriptionException:648 - SubscriptionTask aborted with exception:\njava.lang.OutOfMemoryError: unable to create new native thread\n        at java.lang.Thread.start0(Native Method)\n        at java.lang.Thread.start(Thread.java:714)\n        at org.springframework.core.task.SimpleAsyncTaskExecutor.doExecute(SimpleAsyncTaskExecutor.java:213)\n        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:171)\n        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:151)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer.dispatchMessage(RedisMessageListenerContainer.java:958)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer.access$1400(RedisMessageListenerContainer.java:71)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer$DispatchMessageListener.onMessage(RedisMessageListenerContainer.java:949)\n        at org.springframework.data.redis.connection.jedis.JedisMessageListener.onPMessage(JedisMessageListener.java:43)\n        at redis.clients.jedis.BinaryJedisPubSub.process(BinaryJedisPubSub.java:109)\n        at redis.clients.jedis.BinaryJedisPubSub.proceedWithPatterns(BinaryJedisPubSub.java:75)\n        at redis.clients.jedis.BinaryJedis.psubscribe(BinaryJedis.java:2953)\n        at org.springframework.data.redis.connection.jedis.JedisConnection.pSubscribe(JedisConnection.java:2959)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.eventuallyPerformSubscription(RedisMessageListenerContainer.java:773)\n        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.run(RedisMessageListenerContainer.java:740)\n        at java.lang.Thread.run(Thread.java:745)\nException in thread \"http-apr-10090-Acceptor-0\" java.lang.OutOfMemoryError: unable to create new native thread\n        at java.lang.Thread.start0(Native Method)\n        at java.lang.Thread.start(Thread.java:714)\n        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:950)\n        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1368)\n        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:161)\n        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:141)\n        at org.apache.catalina.core.StandardThreadExecutor.execute(StandardThreadExecutor.java:169)\n        at org.apache.tomcat.util.net.AprEndpoint.processSocketWithOptions(AprEndpoint.java:909)\n        at org.apache.tomcat.util.net.AprEndpoint$Acceptor.run(AprEndpoint.java:1086)\n        at java.lang.Thread.run(Thread.java:745)\n```\n\n## 원인\n1. [spring-session](https://github.com/spring-projects/spring-session)에서 [spring-data-redis]를 사용할 때 [RedisMessageListenerContainer의 taskExecutor](https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L97)에 별도의 값을 설정하지 않아서 [SimpleAsyncTaskExecutor](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java)를 사용하고 있음\n2. [SimpleAsyncTaskExecutor 문서](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html)에서 이 클래스는 쓰레드를 재사용하지 않으니 실행시간이 짧은 많은 수의 작업에는 사용하지 말라고 권장하고 있음\n    - ``NOTE: This implementation does not reuse threads! Consider a thread-pooling TaskExecutor implementation instead, in particular for executing a large number of short-lived tasks.``\n3. spring-session에서 세션정보에 접근하기 위해서 redis를 사용할 때 마다 Thread가 매번 생성됨\n4. 접속량이 많이지게 되면 ``OutOfMemoryError`` 발생\n\n## 해결책\n1. SimpleAsyncTaskExecutor 대신에 ThreadPool을 사용할 수 있도록 지정한다\n2. 하지만 지금 사용중인 ``spring-session-1.0.2.RELEASE`` 버전에서는 taskExecutor를 별도로 지정할 수 있는 방법이 없음\n3. 결국 ``spring-session-1.3.1.RELEASE`` 버전으로 업데이트\n4. [패치된 내용](https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92)을 바탕으로 ``springSessionRedisTaskExecutor``를 지정\n5. ``springSessionRedisTaskExecutor``를 지정하면 일어나는 일\n  1. ``springSessionRedisTaskExecutor``를 지정하면 ``RedisHttpSessionConfiguration.redisTaskExecutor``에 지정한 ``springSessionRedisTaskExecutor``가 할당 됨 [소스코드](https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L203)\n  2. ``RedisMessageListenerContainer.taskExecutor``에 ``RedisHttpSessionConfiguration.redisTaskExecutor``가 할당 됨 [소스코드](https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L93)\n  3. spring-session에서 redis를 사용할 때 ``springSessionRedisTaskExecutor``를 사용하게 됨 [소스코드](https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L961)\n\n```java\n@Configuration\npublic class FrontSessionConfig {\n    @Bean\n    public Executor springSessionRedisTaskExecutor() {\n        ThreadFactory threadFactory = new ThreadFactory() {\n            private int threadCount = 0;\n\n            @Override\n            public Thread newThread(Runnable runnable) {\n                return new Thread(runnable, String.format(\"gajago-session-redis-%d\", ++threadCount));\n            }\n        };\n\n        return Executors.newCachedThreadPool(threadFactory);\n    }\n}\n```\n\n\n## 남아있는 과제\n1. 왜 1번 서버는 안 죽고 2번 서버만 죽었을까?\n2. KT 로드밸런서가 왜 2번 서버로 계속 요청을 보냈을까?\n3. 캐시로 사용하고 있는 redis의 taskExecutor는?\n\n## 관련자료\n* https://github.com/spring-projects/spring-session\n* https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92\n* https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java\n* https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html\n","slug":"ts-spring-session-oome","published":1,"updated":"2018-02-19T08:40:12.744Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjdu1d4j000055707qdd9q9md","content":"<h1 id=\"Trouble-Shooting-spring-session-OOME\"><a href=\"#Trouble-Shooting-spring-session-OOME\" class=\"headerlink\" title=\"[Trouble Shooting] spring-session OOME\"></a>[Trouble Shooting] spring-session OOME</h1><h2 id=\"증상\"><a href=\"#증상\" class=\"headerlink\" title=\"증상\"></a>증상</h2><ol>\n<li>2번 서버가 OutOfMemoryError로 갑자기 죽어버렸음</li>\n<li>KT 로드밸런서가 2번 서버로 계속 요청을 보냄</li>\n<li>사용자의 요청이 1번 서버로만 간 경우 정상적으로 서비스를 이용</li>\n<li>사용자의 요청이 2번으로 하나라도 가면 API의 응답을 받지 못함</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2017-08-04 19:40:51 [gajago-front] [redisMessageListenerContainer-1] ERROR org.springframework.data.redis.listener.RedisMessageListenerContainer:handleSubscriptionException:648 - SubscriptionTask aborted with exception:</span><br><span class=\"line\">java.lang.OutOfMemoryError: unable to create new native thread</span><br><span class=\"line\">        at java.lang.Thread.start0(Native Method)</span><br><span class=\"line\">        at java.lang.Thread.start(Thread.java:714)</span><br><span class=\"line\">        at org.springframework.core.task.SimpleAsyncTaskExecutor.doExecute(SimpleAsyncTaskExecutor.java:213)</span><br><span class=\"line\">        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:171)</span><br><span class=\"line\">        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:151)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer.dispatchMessage(RedisMessageListenerContainer.java:958)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer.access$1400(RedisMessageListenerContainer.java:71)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer$DispatchMessageListener.onMessage(RedisMessageListenerContainer.java:949)</span><br><span class=\"line\">        at org.springframework.data.redis.connection.jedis.JedisMessageListener.onPMessage(JedisMessageListener.java:43)</span><br><span class=\"line\">        at redis.clients.jedis.BinaryJedisPubSub.process(BinaryJedisPubSub.java:109)</span><br><span class=\"line\">        at redis.clients.jedis.BinaryJedisPubSub.proceedWithPatterns(BinaryJedisPubSub.java:75)</span><br><span class=\"line\">        at redis.clients.jedis.BinaryJedis.psubscribe(BinaryJedis.java:2953)</span><br><span class=\"line\">        at org.springframework.data.redis.connection.jedis.JedisConnection.pSubscribe(JedisConnection.java:2959)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.eventuallyPerformSubscription(RedisMessageListenerContainer.java:773)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.run(RedisMessageListenerContainer.java:740)</span><br><span class=\"line\">        at java.lang.Thread.run(Thread.java:745)</span><br><span class=\"line\">Exception in thread &quot;http-apr-10090-Acceptor-0&quot; java.lang.OutOfMemoryError: unable to create new native thread</span><br><span class=\"line\">        at java.lang.Thread.start0(Native Method)</span><br><span class=\"line\">        at java.lang.Thread.start(Thread.java:714)</span><br><span class=\"line\">        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:950)</span><br><span class=\"line\">        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1368)</span><br><span class=\"line\">        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:161)</span><br><span class=\"line\">        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:141)</span><br><span class=\"line\">        at org.apache.catalina.core.StandardThreadExecutor.execute(StandardThreadExecutor.java:169)</span><br><span class=\"line\">        at org.apache.tomcat.util.net.AprEndpoint.processSocketWithOptions(AprEndpoint.java:909)</span><br><span class=\"line\">        at org.apache.tomcat.util.net.AprEndpoint$Acceptor.run(AprEndpoint.java:1086)</span><br><span class=\"line\">        at java.lang.Thread.run(Thread.java:745)</span><br></pre></td></tr></table></figure>\n<h2 id=\"원인\"><a href=\"#원인\" class=\"headerlink\" title=\"원인\"></a>원인</h2><ol>\n<li><a href=\"https://github.com/spring-projects/spring-session\" target=\"_blank\" rel=\"noopener\">spring-session</a>에서 [spring-data-redis]를 사용할 때 <a href=\"https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L97\" target=\"_blank\" rel=\"noopener\">RedisMessageListenerContainer의 taskExecutor</a>에 별도의 값을 설정하지 않아서 <a href=\"https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java\" target=\"_blank\" rel=\"noopener\">SimpleAsyncTaskExecutor</a>를 사용하고 있음</li>\n<li><a href=\"https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html\" target=\"_blank\" rel=\"noopener\">SimpleAsyncTaskExecutor 문서</a>에서 이 클래스는 쓰레드를 재사용하지 않으니 실행시간이 짧은 많은 수의 작업에는 사용하지 말라고 권장하고 있음<ul>\n<li><code>NOTE: This implementation does not reuse threads! Consider a thread-pooling TaskExecutor implementation instead, in particular for executing a large number of short-lived tasks.</code></li>\n</ul>\n</li>\n<li>spring-session에서 세션정보에 접근하기 위해서 redis를 사용할 때 마다 Thread가 매번 생성됨</li>\n<li>접속량이 많이지게 되면 <code>OutOfMemoryError</code> 발생</li>\n</ol>\n<h2 id=\"해결책\"><a href=\"#해결책\" class=\"headerlink\" title=\"해결책\"></a>해결책</h2><ol>\n<li>SimpleAsyncTaskExecutor 대신에 ThreadPool을 사용할 수 있도록 지정한다</li>\n<li>하지만 지금 사용중인 <code>spring-session-1.0.2.RELEASE</code> 버전에서는 taskExecutor를 별도로 지정할 수 있는 방법이 없음</li>\n<li>결국 <code>spring-session-1.3.1.RELEASE</code> 버전으로 업데이트</li>\n<li><a href=\"https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92\" target=\"_blank\" rel=\"noopener\">패치된 내용</a>을 바탕으로 <code>springSessionRedisTaskExecutor</code>를 지정</li>\n<li><code>springSessionRedisTaskExecutor</code>를 지정하면 일어나는 일<ol>\n<li><code>springSessionRedisTaskExecutor</code>를 지정하면 <code>RedisHttpSessionConfiguration.redisTaskExecutor</code>에 지정한 <code>springSessionRedisTaskExecutor</code>가 할당 됨 <a href=\"https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L203\" target=\"_blank\" rel=\"noopener\">소스코드</a></li>\n<li><code>RedisMessageListenerContainer.taskExecutor</code>에 <code>RedisHttpSessionConfiguration.redisTaskExecutor</code>가 할당 됨 <a href=\"https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L93\" target=\"_blank\" rel=\"noopener\">소스코드</a></li>\n<li>spring-session에서 redis를 사용할 때 <code>springSessionRedisTaskExecutor</code>를 사용하게 됨 <a href=\"https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L961\" target=\"_blank\" rel=\"noopener\">소스코드</a></li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FrontSessionConfig</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Executor <span class=\"title\">springSessionRedisTaskExecutor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ThreadFactory threadFactory = <span class=\"keyword\">new</span> ThreadFactory() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> threadCount = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable runnable)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Thread(runnable, String.format(<span class=\"string\">\"gajago-session-redis-%d\"</span>, ++threadCount));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Executors.newCachedThreadPool(threadFactory);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"남아있는-과제\"><a href=\"#남아있는-과제\" class=\"headerlink\" title=\"남아있는 과제\"></a>남아있는 과제</h2><ol>\n<li>왜 1번 서버는 안 죽고 2번 서버만 죽었을까?</li>\n<li>KT 로드밸런서가 왜 2번 서버로 계속 요청을 보냈을까?</li>\n<li>캐시로 사용하고 있는 redis의 taskExecutor는?</li>\n</ol>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><ul>\n<li><a href=\"https://github.com/spring-projects/spring-session\" target=\"_blank\" rel=\"noopener\">https://github.com/spring-projects/spring-session</a></li>\n<li><a href=\"https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92\" target=\"_blank\" rel=\"noopener\">https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92</a></li>\n<li><a href=\"https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java\" target=\"_blank\" rel=\"noopener\">https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java</a></li>\n<li><a href=\"https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html\" target=\"_blank\" rel=\"noopener\">https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Trouble-Shooting-spring-session-OOME\"><a href=\"#Trouble-Shooting-spring-session-OOME\" class=\"headerlink\" title=\"[Trouble Shooting] spring-session OOME\"></a>[Trouble Shooting] spring-session OOME</h1><h2 id=\"증상\"><a href=\"#증상\" class=\"headerlink\" title=\"증상\"></a>증상</h2><ol>\n<li>2번 서버가 OutOfMemoryError로 갑자기 죽어버렸음</li>\n<li>KT 로드밸런서가 2번 서버로 계속 요청을 보냄</li>\n<li>사용자의 요청이 1번 서버로만 간 경우 정상적으로 서비스를 이용</li>\n<li>사용자의 요청이 2번으로 하나라도 가면 API의 응답을 받지 못함</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2017-08-04 19:40:51 [gajago-front] [redisMessageListenerContainer-1] ERROR org.springframework.data.redis.listener.RedisMessageListenerContainer:handleSubscriptionException:648 - SubscriptionTask aborted with exception:</span><br><span class=\"line\">java.lang.OutOfMemoryError: unable to create new native thread</span><br><span class=\"line\">        at java.lang.Thread.start0(Native Method)</span><br><span class=\"line\">        at java.lang.Thread.start(Thread.java:714)</span><br><span class=\"line\">        at org.springframework.core.task.SimpleAsyncTaskExecutor.doExecute(SimpleAsyncTaskExecutor.java:213)</span><br><span class=\"line\">        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:171)</span><br><span class=\"line\">        at org.springframework.core.task.SimpleAsyncTaskExecutor.execute(SimpleAsyncTaskExecutor.java:151)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer.dispatchMessage(RedisMessageListenerContainer.java:958)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer.access$1400(RedisMessageListenerContainer.java:71)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer$DispatchMessageListener.onMessage(RedisMessageListenerContainer.java:949)</span><br><span class=\"line\">        at org.springframework.data.redis.connection.jedis.JedisMessageListener.onPMessage(JedisMessageListener.java:43)</span><br><span class=\"line\">        at redis.clients.jedis.BinaryJedisPubSub.process(BinaryJedisPubSub.java:109)</span><br><span class=\"line\">        at redis.clients.jedis.BinaryJedisPubSub.proceedWithPatterns(BinaryJedisPubSub.java:75)</span><br><span class=\"line\">        at redis.clients.jedis.BinaryJedis.psubscribe(BinaryJedis.java:2953)</span><br><span class=\"line\">        at org.springframework.data.redis.connection.jedis.JedisConnection.pSubscribe(JedisConnection.java:2959)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.eventuallyPerformSubscription(RedisMessageListenerContainer.java:773)</span><br><span class=\"line\">        at org.springframework.data.redis.listener.RedisMessageListenerContainer$SubscriptionTask.run(RedisMessageListenerContainer.java:740)</span><br><span class=\"line\">        at java.lang.Thread.run(Thread.java:745)</span><br><span class=\"line\">Exception in thread &quot;http-apr-10090-Acceptor-0&quot; java.lang.OutOfMemoryError: unable to create new native thread</span><br><span class=\"line\">        at java.lang.Thread.start0(Native Method)</span><br><span class=\"line\">        at java.lang.Thread.start(Thread.java:714)</span><br><span class=\"line\">        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:950)</span><br><span class=\"line\">        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1368)</span><br><span class=\"line\">        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:161)</span><br><span class=\"line\">        at org.apache.tomcat.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:141)</span><br><span class=\"line\">        at org.apache.catalina.core.StandardThreadExecutor.execute(StandardThreadExecutor.java:169)</span><br><span class=\"line\">        at org.apache.tomcat.util.net.AprEndpoint.processSocketWithOptions(AprEndpoint.java:909)</span><br><span class=\"line\">        at org.apache.tomcat.util.net.AprEndpoint$Acceptor.run(AprEndpoint.java:1086)</span><br><span class=\"line\">        at java.lang.Thread.run(Thread.java:745)</span><br></pre></td></tr></table></figure>\n<h2 id=\"원인\"><a href=\"#원인\" class=\"headerlink\" title=\"원인\"></a>원인</h2><ol>\n<li><a href=\"https://github.com/spring-projects/spring-session\" target=\"_blank\" rel=\"noopener\">spring-session</a>에서 [spring-data-redis]를 사용할 때 <a href=\"https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L97\" target=\"_blank\" rel=\"noopener\">RedisMessageListenerContainer의 taskExecutor</a>에 별도의 값을 설정하지 않아서 <a href=\"https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java\" target=\"_blank\" rel=\"noopener\">SimpleAsyncTaskExecutor</a>를 사용하고 있음</li>\n<li><a href=\"https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html\" target=\"_blank\" rel=\"noopener\">SimpleAsyncTaskExecutor 문서</a>에서 이 클래스는 쓰레드를 재사용하지 않으니 실행시간이 짧은 많은 수의 작업에는 사용하지 말라고 권장하고 있음<ul>\n<li><code>NOTE: This implementation does not reuse threads! Consider a thread-pooling TaskExecutor implementation instead, in particular for executing a large number of short-lived tasks.</code></li>\n</ul>\n</li>\n<li>spring-session에서 세션정보에 접근하기 위해서 redis를 사용할 때 마다 Thread가 매번 생성됨</li>\n<li>접속량이 많이지게 되면 <code>OutOfMemoryError</code> 발생</li>\n</ol>\n<h2 id=\"해결책\"><a href=\"#해결책\" class=\"headerlink\" title=\"해결책\"></a>해결책</h2><ol>\n<li>SimpleAsyncTaskExecutor 대신에 ThreadPool을 사용할 수 있도록 지정한다</li>\n<li>하지만 지금 사용중인 <code>spring-session-1.0.2.RELEASE</code> 버전에서는 taskExecutor를 별도로 지정할 수 있는 방법이 없음</li>\n<li>결국 <code>spring-session-1.3.1.RELEASE</code> 버전으로 업데이트</li>\n<li><a href=\"https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92\" target=\"_blank\" rel=\"noopener\">패치된 내용</a>을 바탕으로 <code>springSessionRedisTaskExecutor</code>를 지정</li>\n<li><code>springSessionRedisTaskExecutor</code>를 지정하면 일어나는 일<ol>\n<li><code>springSessionRedisTaskExecutor</code>를 지정하면 <code>RedisHttpSessionConfiguration.redisTaskExecutor</code>에 지정한 <code>springSessionRedisTaskExecutor</code>가 할당 됨 <a href=\"https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L203\" target=\"_blank\" rel=\"noopener\">소스코드</a></li>\n<li><code>RedisMessageListenerContainer.taskExecutor</code>에 <code>RedisHttpSessionConfiguration.redisTaskExecutor</code>가 할당 됨 <a href=\"https://github.com/spring-projects/spring-session/blob/master/spring-session-data-redis/src/main/java/org/springframework/session/data/redis/config/annotation/web/http/RedisHttpSessionConfiguration.java#L93\" target=\"_blank\" rel=\"noopener\">소스코드</a></li>\n<li>spring-session에서 redis를 사용할 때 <code>springSessionRedisTaskExecutor</code>를 사용하게 됨 <a href=\"https://github.com/spring-projects/spring-data-redis/blob/master/src/main/java/org/springframework/data/redis/listener/RedisMessageListenerContainer.java#L961\" target=\"_blank\" rel=\"noopener\">소스코드</a></li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FrontSessionConfig</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Executor <span class=\"title\">springSessionRedisTaskExecutor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ThreadFactory threadFactory = <span class=\"keyword\">new</span> ThreadFactory() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> threadCount = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable runnable)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Thread(runnable, String.format(<span class=\"string\">\"gajago-session-redis-%d\"</span>, ++threadCount));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Executors.newCachedThreadPool(threadFactory);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"남아있는-과제\"><a href=\"#남아있는-과제\" class=\"headerlink\" title=\"남아있는 과제\"></a>남아있는 과제</h2><ol>\n<li>왜 1번 서버는 안 죽고 2번 서버만 죽었을까?</li>\n<li>KT 로드밸런서가 왜 2번 서버로 계속 요청을 보냈을까?</li>\n<li>캐시로 사용하고 있는 redis의 taskExecutor는?</li>\n</ol>\n<h2 id=\"관련자료\"><a href=\"#관련자료\" class=\"headerlink\" title=\"관련자료\"></a>관련자료</h2><ul>\n<li><a href=\"https://github.com/spring-projects/spring-session\" target=\"_blank\" rel=\"noopener\">https://github.com/spring-projects/spring-session</a></li>\n<li><a href=\"https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92\" target=\"_blank\" rel=\"noopener\">https://github.com/tsachev/spring-session/commit/6604bf180221028aff47f999418c0d48db72fb92</a></li>\n<li><a href=\"https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java\" target=\"_blank\" rel=\"noopener\">https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/task/SimpleAsyncTaskExecutor.java</a></li>\n<li><a href=\"https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html\" target=\"_blank\" rel=\"noopener\">https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html</a></li>\n</ul>\n"}],"PostAsset":[{"_id":"source/_posts/server-network-perf/highway-393492_1920.jpg","slug":"highway-393492_1920.jpg","post":"cjdu1d4it00025707z503pmvf","modified":0,"renderable":0},{"_id":"source/_posts/ts-ios-wifi-webkit-error/webkit-error.png","slug":"webkit-error.png","post":"cjdu1d4ix00045707emb3haie","modified":0,"renderable":0},{"_id":"source/_posts/how-cookie-works/breadcrumbs.jpg","slug":"breadcrumbs.jpg","post":"cjdu1d4im00005707u4zrrvbs","modified":0,"renderable":0},{"_id":"source/_posts/how-cookie-works/dev-tools-cookie.png","slug":"dev-tools-cookie.png","post":"cjdu1d4im00005707u4zrrvbs","modified":0,"renderable":0},{"_id":"source/_posts/how-cookie-works/http-req-res.png","slug":"http-req-res.png","post":"cjdu1d4im00005707u4zrrvbs","modified":0,"renderable":0}],"PostCategory":[],"PostTag":[],"Tag":[]}}